(function(){var a;this.locale={"pt-BR":{measures:{label:"Medidas",waist:{label:"Cintura",description:"Você provavelmente sabe onde fica, mas aqui vai a dica: a cintura é aquela região próxima ao umbigo."},shoulders:{label:"Ombros",description:"De ombro a ombro (de um lado dele ao outro)"},bust:{label:"Busto",description:"Para medir o busto, posicione a régua no centro do tronco, na altura do peito."},hips:{label:"Quadril",description:"Posicione a régua na região mais larga dos quadris para tirar a medida."},arm:{label:"Braço",description:"Meça do fim dos ombros até o ossinho dos pulsos."},right_wrist:{label:"Punho direito",description:"Meça de um lado a outro do punho."},reference:{label:"Largura da Mão",description:"Posicione a medida da mão, conforme a medição realizada no primeiro passo."},trunk:{label:"Tronco",description:"Considerando do ombro até o quadril."}}}},a=navigator.language||window.navigator.userLanguage,this.t=this.locale[a]||this.locale["pt-BR"]}).call(this),function(){this.Search=function(){function a(){this.processParams(),this.type||(this.type="tshirt"),this.gender||(this.gender="M"),this.trend||(this.trend="kanui")}return a.prototype.processParams=function(){var a,b,c,d,e,f,g,h;for(b=window.location.search.substring(1),c=b.split("&"),h=[],e=0,f=c.length;f>e;e++)b=c[e],g=b.split("="),a=g[0],d=g[1],h.push(this[a]=d);return h},a.prototype.models=function(){return wear[this.trend][this.gender][this.type]},a.prototype.measuresNeeded=function(){var a,b,c,d,e;c={front:[],side:[]},e=this.models().models[0].measures;for(b in e)d=e[b],a=/(front|side)[A-Z]/.exec(b),a?(b=b.replace(a[1],"").toLowerCase(),c[a[1]].push(b)):(c.front.push(b),c.side.push(b));return c},a.prototype.fitsWith=function(a,b){return this.models().match(a,b)},a}()}.call(this),function(){this.CountdownTimer=function(){function a(a,b,c){this.seconds=a,this.onFinish=b,this.eachStep=c,this.sound=UI.audio("countdown","mp3"),this.flash=UI.audio("flash","ogg"),this.success=UI.audio("success","mp3")}return a.prototype.perform=function(a,b){var c;return null==a&&(a="flash"),null==b&&(b=!1),c=function(d){var e,f,g;if(e=d,b?(e=this.seconds-d-1,UI.progress(parseInt(100*e/this.seconds))):UI.countdown(e),0>d){if("function"==typeof this.onFinish&&this.onFinish(),a)return"flash"===a?null!=(f=this.flash)?f.play():void 0:null!=(g=this.success)?g.play():void 0}else if(null==this.canceled&&setTimeout(c.bind(this),1e3,d-1),"function"==typeof this.eachStep&&this.eachStep(d),4>d)return this.sound.play()},c.bind(this)(this.seconds)},a.prototype.cancel=function(){return this.canceled=!0},a}()}.call(this),function(){this.Slic=function(){function a(a,b){this.imageData=ImageProcessing.dupImageDataColor(a),b=b||{},this.regionSize=b.regionSize||16,this.minRegionSize=b.minRegionSize||Math.round(.8*this.regionSize),this.maxIterations=b.maxIterations||this.regionSize/2,this._compute()}return a.prototype.finer=function(){var a;return a=Math.max(5,Math.round(this.regionSize/Math.sqrt(2))),a!==this.regionSize?(this.regionSize=a,this.minRegionSize=Math.round(.8*a),this._compute()):void 0},a.prototype.coarser=function(){var a;return a=Math.min(640,Math.round(this.regionSize*Math.sqrt(2))),a!==this.regionSize?(this.regionSize=a,this.minRegionSize=Math.round(.8*a),this._compute()):void 0},a.prototype._compute=function(){return this.result=this.computeSLICSegmentation(this.imageData,this.regionSize,this.minRegionSize,this.maxIterations)},a.prototype.rgb2xyz=function(a,b,c){var d,e,f,g,h,i,j,k;for(i=new Float32Array(3*b*c),f=2.2,g=j=0,k=b*c;k>=0?k>j:j>k;g=k>=0?++j:--j)h=.00392156862*a[4*g+0],e=.00392156862*a[4*g+1],d=.00392156862*a[4*g+2],h=Math.pow(h,f),e=Math.pow(e,f),d=Math.pow(d,f),i[g]=.488718*h+.31068*e+.200602*d,i[g+b*c]=.176204*h+.812985*e+.0108109*d,i[g+2*b*c]=.0102048*e+.989795*d;return i},a.prototype.xyz2lab=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;for(g=function(a){return a>.00856?Math.pow(a,.33333333):7.78706891568*a+.1379310336},p=1/3,q=1/3,e=1,d=p/q,f=(1-p-q)/(q*e),l=1/d,m=1/e,n=1/f,o=new Float32Array(3*b*c),k=r=0,s=b*c;s>=0?s>r:r>s;k=s>=0?++r:--r)h=g(a[k]*l),i=g(a[b*c+k]*m),j=g(a[2*b*c+k]*n),o[k]=116*i-16,o[k+b*c]=500*(h-i),o[k+2*b*c]=200*(i-j);return o},a.prototype.computeEdge=function(a,b,c,d){var e,f,g,h,i,j,k,l,m;for(m=[],i=l=0;3>l;i=++l)m.push(function(){var l,m,n;for(n=[],k=l=1,m=d-1;m>=1?m>l:l>m;k=m>=1?++l:--l)n.push(function(){var l,m,n;for(n=[],j=l=1,m=c-1;m>=1?m>l:l>m;j=m>=1?++l:--l)e=a[i*c*d+k*c+j-1],f=a[i*c*d+k*c+j+1],g=a[i*c*d+(k+1)*c+j],h=a[i*c*d+(k-1)*c+j],n.push(b[k*c+j]+=Math.pow(e-f,2)+Math.pow(g-h,2));return n}());return n}());return m},a.prototype.initializeKmeansCenters=function(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t,u,v;for(l=0,m=0,v=[],p=u=0;f>=0?f>u:u>f;p=f>=0?++u:--u)v.push(function(){var f,u,v,w,x,y,z,A;for(A=[],o=f=0;e>=0?e>f:f>e;o=e>=0?++f:--f){for(j=0,k=0,n=1/0,q=parseInt(Math.round(g*(o+.5)),10),s=parseInt(Math.round(g*(p+.5)),10),q=Math.max(Math.min(q,h-1),0),s=Math.max(Math.min(s,i-1),0),t=u=w=Math.max(0,s-1),x=Math.min(i-1,s+1);x>=w?x>u:u>x;t=x>=w?++u:--u)for(r=v=y=Math.max(0,q-1),z=Math.min(h-1,q+1);z>=y?z>v:v>z;r=z>=y?++v:--v)this.dgeValue=b[t*h+r],this.dgeValue<n&&(n=this.dgeValue,j=r,k=t);c[l++]=parseFloat(j),c[l++]=parseFloat(k),c[l++]=a[k*h+j],c[l++]=a[h*i+k*h+j],c[l++]=a[2*h*i+k*h+j],d[m++]=100,A.push(d[m++]=g*g)}return A}.call(this));return v},a.prototype.computeCenters=function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o;for(k=l=0;g>=0?g>l:l>g;k=g>=0?++l:--l)for(j=m=0;f>=0?f>m:m>f;j=f>=0?++m:--m)i=b[j+k*f],c[i]++,d[5*i+0]+=j,d[5*i+1]+=k,d[5*i+2]+=a[k*f+j],d[5*i+3]+=a[f*g+k*f+j],d[5*i+4]+=a[2*f*g+k*f+j];for(o=[],i=n=0;e>=0?e>n:n>e;i=e>=0?++n:--n)h=1/Math.max(c[i],1e-8),d[5*i]=d[5*i]*h,d[5*i+1]=d[5*i+1]*h,d[5*i+2]=d[5*i+2]*h,d[5*i+3]=d[5*i+3]*h,o.push(d[5*i+4]=d[5*i+4]*h);return o},a.prototype.eliminateSmallRegions=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;for(f=new Int32Array(c),q=new Int32Array(c),i=new Array(1,-1,0,0),j=new Array(0,0,1,-1),p=w=0;c>=0?c>w:w>c;p=c>=0?++w:--w)if(!f[p]){for(l=a[p],n=0,r=0,q[r++]=p,g=l+1,f[p]=l+1,s=p%d,u=Math.floor(p/d),h=x=0;4>x;h=++x)t=s+i[h],v=u+j[h],m=t+v*d,t>=0&&d>t&&v>=0&&e>v&&f[m]&&(g=f[m]);for(;r>n;)for(o=q[n++],s=o%d,u=Math.floor(o/d),h=y=0;4>y;h=++y)t=s+i[h],v=u+j[h],m=t+v*d,t>=0&&d>t&&v>=0&&e>v&&0===f[m]&&a[m]===l&&(f[m]=l+1,q[r++]=m);if(b>r)for(;r>0;)f[q[--r]]=g}for(p=z=0;c>=0?c>z:z>c;p=c>=0?++z:--z)--f[p];for(B=[],k=A=0;c>=0?c>A:A>c;k=c>=0?++A:--A)B.push(a[k]=f[k]);return B},a.prototype.updateClusterParams=function(a,b,c,d){var e,f,g,h,i,j,k;for(f=new Float32Array(d.length/2),g=new Float32Array(d.length/2),k=[],e=i=0,j=a.length;j>=0?j>i:i>j;e=j>=0?++i:--i)h=a[e],f[h]<b[h]&&(f[h]=b[h],d[2*h+0]=b[h]),g[h]<c[h]?(g[h]=c[h],k.push(d[2*h+1]=c[h])):k.push(void 0);return k},a.prototype.assignSuperpixelLabel=function(a,b,c,d,e,f,g,h,i,j,k,l){var m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K;for(u=z=0,E=e.length;E>=0?E>z:z>E;u=E>=0?++z:--z)e[u]=1/0;for(m=j,v=A=0,F=h*i;F>=0?F>A:A>F;v=F>=0?++A:--A)for(o=Math.round(f[5*v+0]),p=Math.round(f[5*v+1]),y=B=G=Math.max(0,p-m),H=Math.min(l,p+m);H>=G?H>B:B>H;y=H>=G?++B:--B)for(x=C=I=Math.max(0,o-m),J=Math.min(k,o+m);J>=I?J>C:C>J;x=J>=I?++C:--C)w=(x-o)*(x-o)+(y-p)*(y-p),s=a[y*k+x]-f[5*v+2],r=a[k*l+y*k+x]-f[5*v+3],q=a[2*k*l+y*k+x]-f[5*v+4],n=s*s+r*r+q*q,t=Math.sqrt(n/g[2*v+0]+w/g[2*v+1]),t<e[y*k+x]&&(e[y*k+x]=t,b[y*k+x]=v);for(K=[],y=D=0;l>=0?l>D:D>l;y=l>=0?++D:--D)K.push(function(){var a,e;for(e=[],x=a=0;k>=0?k>a:a>k;x=k>=0?++a:--a)g[2*b[y*k+x]]<c[y*k+x]&&(g[2*b[y*k+x]]=c[y*k+x]),g[2*b[y*k+x]+1]<d[y*k+x]?e.push(g[2*b[y*k+x]+1]=d[y*k+x]):e.push(void 0);return e}());return K},a.prototype.computeResidualError=function(a,b){var c,d,e,f,g;for(d=0,e=f=0,g=a.length;g>=0?g>f:f>g;e=g>=0?++f:--f)c=a[e]-b[e],d+=Math.sqrt(c*c);return d},a.prototype.remapLabels=function(a){var b,c,d,e,f,g;for(e={},c=0,b=f=0,g=a.length;g>=0?g>f:f>g;b=g>=0?++f:--f)d=a[b],void 0===e[d]&&(e[d]=c++),a[b]=e[d];return c},a.prototype.encodeLabels=function(a,b){var c,d,e,f,g,h;for(this.clusters=[],this.segmentation=a,h=[],c=f=0,g=a.length;g>=0?g>f:f>g;c=g>=0?++f:--f)d=Math.floor(a[c]),b[c]=255&d,(e=this.clusters)[d]||(e[d]=[]),h.push(this.clusters[d].push(c));return h},a.prototype.computeSLICSegmentation=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;for(l=a.cols,k=a.rows,u=Math.floor(l/b),v=Math.floor(k/b),t=Math.floor(u*v),s=Math.floor(l*k),h=new Float32Array(s),o=new Array(s),f=new Float32Array(5*t),r=new Float32Array(5*t),e=new Float32Array(2*t),p=new Float32Array(s),q=new Float32Array(s),g=new Float32Array(s),y=this.rgb2xyz(a.data,l,k),n=this.xyz2lab(y,l,k),this.computeEdge(n,h,l,k),this.initializeKmeansCenters(n,h,f,e,u,v,b,l,k),x=new Int32Array(s),m=z=0;d>=0?d>z:z>d;m=d>=0?++z:--z){for(this.assignSuperpixelLabel(n,x,p,q,g,f,e,u,v,b,l,k),this.updateClusterParams(x,p,q,e),j=A=0,D=o.length;D>=0?D>A:A>D;j=D>=0?++A:--A)o[j]=0;for(j=B=0,E=r.length;E>=0?E>B:B>E;j=E>=0?++B:--B)r[j]=0;if(this.computeCenters(n,x,o,r,t,l,k),i=this.computeResidualError(f,r),1e-5>i)break;for(j=C=0,F=f.length;F>=0?F>C:C>F;j=F>=0?++C:--C)f[j]=r[j]}return this.eliminateSmallRegions(x,c,s,l,k),w=ImageProcessing.matrix(l,k),w.numSegments=this.remapLabels(x),this.encodeLabels(x,w.data),w},a}()}.call(this),function(){this.ImageProcessing={matrix:function(a,b){return new jsfeat.matrix_t(a,b,jsfeat.U8_t|jsfeat.C1_t)},matrixColor:function(a,b){return new jsfeat.matrix_t(a,b,jsfeat.U8_t|jsfeat.C4_t)},imageDifferenceAbs:function(a,b){var c,d,e,f,g,h;for(c=ImageProcessing.matrix(a.width,a.height),h=a.data,d=f=0,g=h.length;g>f;d=++f)e=h[d],c[d]=Math.abs(e-b.data[d]);return c},imageDifferenceInPercent:function(a,b){var c,d,e,f,g,h;for(e=0,h=a.data,c=f=0,g=h.length;g>f;c=++f)d=h[c],e+=Math.abs(d-b.data[c]);return e/a.data.length/2.55},grayBlurData:function(a,b){var c;return c=this.grayScale(a)},grayScale:function(a){var b,c,d,e;return e=[a.width,a.height],d=e[0],c=e[1],b=this.matrix(d,c),jsfeat.imgproc.grayscale(a.data,d,c,b),b},blur:function(a,b){return b>0&&jsfeat.imgproc.gaussian_blur(a,a,b),a},convertRGBtoHue:function(a,b,c){var d,e,f,g;return g=Math.min(a,b,c),f=Math.max(a,b,c),e=f-g,d=a===f?b-c:b===f?c-a:a-b,20*Math.abs(d)},convertHSVtoRGB:function(a,b,c){var d,e,f,g,h,i,j,k,l,m;return 1===arguments.length&&(l=a,b=l.s,c=l.v,a=l.h),g=Math.floor(6*a),isNaN(g)?{r:0,g:0,b:0}:(e=6*a-g,h=c*(1-b),i=c*(1-e*b),k=c*(1-(1-e)*b),m=function(){switch(g%6){case 0:return[c,k,h];case 1:return[i,c,h];case 2:return[h,c,k];case 3:return[h,i,c];case 4:return[k,h,c];case 5:return[c,h,i]}}(),j=m[0],f=m[1],d=m[2],{r:Math.round(255*j),g:Math.round(255*f),b:Math.round(255*d)})},convertRGBtoHSV:function(a,b,c){var d,e,f,g,h,i,j;switch(1===arguments.length&&(j=a,c=j.b,b=j.g,a=j.r),f=Math.max(a,b,c),g=Math.min(a,b,c),d=f-g,h=0===f?0:d/f,i=f/255,f){case g:e=0;break;case a:e=b-c+d*(c>b?6:0),e/=6*d;break;case b:e=c-a+2*d,e/=6*d;break;case c:e=a-b+4*d,e/=6*d}return{h:e,s:h,v:i}},convertHSVtoHSL:function(a,b,c){var d,e,f;return 1===arguments.length&&(e=a,b=e.s,c=e.v,a=e.h),f=b*c,d=(2-b)*c,f/=1>=d?d:2-d,d/=2,{h:a,s:f,l:d}},convertHSLtoHSV:function(a,b,c){var d,e,f;return 1===arguments.length&&(d=a,b=d.s,c=d.l,a=d.h),c*=2,b*=1>=c?c:2-c,f=(c+b)/2,e=2*b/(c+b),{h:a,s:e,v:f}},proccessRGB:function(a,b,c){var d,e,f,g,h,i;return g=this.convertRGBtoHSV(a,b,c),g.s=Math.pow(g.s,1.2),g.v=Math.pow(g.v,.5),h=g,f=this.convertHSVtoHSL(g),e=1e3*(Math.pow(f.l,1.8)-.2*Math.pow(g.v,4))-255*Math.pow(f.s,10),0>e&&(e=0),d=.33*a+.33*b+.33*c,g=this.convertRGBtoHSV(d,d,d),""+e!="NaN"&&(g.v+=e/255),g.v=Math.pow(g.v,1.3),g.v>.99&&(g.v=.99),g.v<.01&&(g.v=.01),i=this.convertHSVtoRGB(h.h,h.s,g.v)},getColor:function(a,b,c,d){var e,f,g,h,i;return i=4*(c*d+b),h=a.data[i],g=a.data[i+1],f=a.data[i+2],e=a.data[i+3],new Color(h,g,f,e)},doThreshold:function(a,b){var c,d,e,f,g;for(g=[],c=e=0,f=a.length;f>e;c=++e)d=a[c],g.push(a[c]=d>b?255:0);return g},applyFunctionPair:function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;if(1>b||null==c)return a;for(u=[a.cols,a.rows],m=u[0],e=u[1],h=m*e,f=p=1;b>=1?b>=p:p>=b;f=b>=1?++p:--p){for(i=this.matrix(m,e),o=q=0;e>=0?e>=q:q>=e;o=e>=0?++q:--q)for(n=r=0;m>=0?m>=r:r>=m;n=m>=0?++r:--r)j=o*m+n,i.data[j]=a.data[j];for(o=s=0;e>=0?e>=s:s>=e;o=e>=0?++s:--s)for(n=t=0;m>=0?m>=t:t>=m;n=m>=0?++t:--t)j=o*m+n,v=[j-1,j+1],g=v[0],k=v[1],l=j-m,d=j+m,g>=0&&h>k&&(i.data[j]=c(a.data[j],a.data[g],a.data[k])),l>=0&&h>d&&(i.data[j]=c(i.data[j],a.data[l],a.data[d])),l-1>=0&&(i.data[j]=c(i.data[j],a.data[l+1],a.data[l-1])),h>d+1&&(i.data[j]=c(i.data[j],a.data[d+1],a.data[d-1]));a=i}return a},dilates:function(a,b){return this.applyFunctionPair(a,b,Math.max)},erodes:function(a,b,c,d){return this.applyFunctionPair(a,b,Math.min)},imageDifference:function(a,b,c,d,e,f){var g,h,i,j;for(h=this.matrix(d.cols,d.rows),i=d.data.length,g=j=0;i>=0?i>=j:j>=i;g=i>=0?++j:--j)h.data[g]=e(a,b,c,d,g),h.data[g]<f&&(h.data[g]=f);return h},dupImageGray:function(a){var b,c,d,e;for(b=this.matrix(a.cols,a.rows),d=a.data.length,c=e=0;d>=0?d>=e:e>=d;c=d>=0?++e:--e)b.data[c]=a.data[c];return b},dupImageDataColor:function(a){var b,c,d,e;for(b=this.matrixColor(a.width,a.height),d=a.data.length,c=e=0;d>=0?d>=e:e>=d;c=d>=0?++e:--e)b.data[c]=a.data[c];return b},minimum:function(a,b){var c,d,e,f;for(e=this.matrix(a.cols,a.rows),d=a.data.length,c=f=0;d>=0?d>=f:f>=d;c=d>=0?++f:--f)e.data[c]=Math.min(a.data[c],b.data[c]);return e},imageDifference2:function(a,b,c,d,e,f){var g,h,i,j;for(h=this.matrix(c.cols,c.rows),i=c.data.length,g=j=0;i>=0?i>=j:j>=i;g=i>=0?++j:--j)h.data[g]=d(a,b,c,g),h.data[g]-e<0?h.data[g]=0:h.data[g]=Math.pow(h.data[g],f)/255*(f-1);return h},applyThreshold:function(a,b){var c,d,e;if(d=a.data.length,null!=b)for(c=e=0;d>=0?d>=e:e>=d;c=d>=0?++e:--e)a.data[c]=a.data[c]>b?255:0;return a},normalize:function(a){var b,c,d,e,f,g,h;for(d=a.data.length,f=1e4,e=0,c=g=0;d>=0?d>=g:g>=d;c=d>=0?++g:--g)b=a.data[c],f>b&&(f=b),b>e&&(e=b);for(b=255/(e-f),c=h=0;d>=0?d>=h:h>=d;c=d>=0?++h:--h)a.data[c]=(a.data[c]-f)*b;return a},forEachPixel:function(a,b,c){var d,e,f,g,h,i,j;for(f=this.matrix(a.cols,a.rows),e=a.data.length,j=a.data,d=h=0,i=j.length;i>h;d=++h)g=j[d],f.data[d]=c(g,b.data[d]);return f},getImageValue:function(a,b,c){var d,e;return 2===arguments.length&&(c=Math.round(b.y),b=Math.round(b.x)),d=c*a.cols+b,e=a.data[d]},findFace:function(a,b,c){var d;return this.faceDetector=new objectdetect.detector(a.width,a.height,b.scale_factor,objectdetect.frontalface),d=this.faceDetector.detect(a,1,b.step,null,c)[0],d?d[5]="frontal":(this.faceDetector=new objectdetect.detector(a.width,a.height,b.scale_factor,objectdetect.frontalface_alt),d=this.faceDetector.detect(a,1,b.step,null,c)[0],d?d[5]="frontal alt":(this.faceDetector=new objectdetect.detector(a.width,a.height,b.scale_factor,objectdetect.profileface),d=this.faceDetector.detect(a,1,b.step,null,c)[0],d&&(d[5]="profile"))),d},findFaceViaJSFeat:function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o;return d=jsfeat.haar.frontalface,o=[a.width,a.height],n=o[0],e=o[1],m=(n+1)*(e+1),j=function(){return new Int32Array(m)},h=j(),g=j(),i=j(),f=j(),k=160,jsfeat.imgproc.compute_integral_image(b,h,g,null),jsfeat.haar.edges_density=c.edges_density,l=jsfeat.haar.detect_multi_scale(h,g,i,null,b.cols,b.rows,d,c.scale_factor,c.min_scale),l=jsfeat.haar.group_rectangles(l,1),l.length>0?l:null},findHandFist:function(a,b,c){return this.handFistDetector=new objectdetect.detector(a.width,a.height,b.scale_factor,objectdetect.handfist),this.handFistDetector.detect(a,1,b.step,null,c)},findHandOpen:function(a,b,c){return this.handOpenDetector=new objectdetect.detector(a.width,a.height,b.scale_factor,objectdetect.handopen),this.handOpenDetector.detect(a,1,b.step,null,c)}}}.call(this),function(){filepicker.setKey("AN8l6x4Shekrztt8K7Xxwz"),this.ImageStore={opts:{mimetype:"image/png",base64decode:!0},upload:function(a,b,c,d){return filepicker.store(a,ImageStore.opts,b,c,d)}}}.call(this),function(){this.HumanBody=function(){function a(a,b,c,d,e){this.head=a,this.map=b,this.handLeft=c,this.handRight=d,this.side=e,this.skeleton=new Skeleton(this.head,this.map,this.side),this.skeleton.updateHandLeft(this.handLeft),this.skeleton.updateHandRight(this.handRight),this.skeleton.correlatePoints()}return a.prototype.waistLimits=function(){return{start:this.skeleton.waist.y-this.head.height,end:this.skeleton.waist.y+this.head.height}},a.prototype.heightLimits=function(){return{start:this.head.y,min:this.head.y+5*this.head.height,max:this.head.y+8*this.head.height}},a.prototype.shouldersLimits=function(){return{start:this.skeleton.shoulderLeft.x-this.head.width/2,end:this.skeleton.shoulderRight.x+this.head.width/2}},a}(),this.Skeleton=function(){function a(a,b,c){this.head=a,this.map=b,this.side=c,this.head.y+7*this.head.height<b.rows&&(this.fullbody=!0),this.neck=new Point(this.head.x+this.head.width/2,this.head.y+.75*this.head.height),this.chestCenter=new Point(this.neck.x,this.neck.y+1.25*this.head.height),this.chestCenter.x=this.centerX(this.map,this.chestCenter.x,this.chestCenter.y),this.neck.x=this.chestCenter.x,this.waist=new Point(this.chestCenter.x,this.chestCenter.y+this.head.height),this.hips=new Point(this.waist.x,this.waist.y+this.head.height),this.side?(this.shoulderRight=new Point(this.chestCenter.x,this.chestCenter.y-this.head.height/1.5),this.shoulderLeft=new Point(this.chestCenter.x,this.chestCenter.y-this.head.height/1.5),this.armRight=new Point(this.shoulderRight.x,this.shoulderRight.y+1.4*this.head.height),this.armLeft=new Point(this.shoulderLeft.x,this.shoulderLeft.y+1.4*this.head.height),this.handRight=new Point(this.armRight.x,this.armRight.y+1.5*this.head.height),this.handLeft=new Point(this.armLeft.x,this.armLeft.y+1.5*this.head.height),this.fullbody&&(this.legRight=new Point(this.hips.x,this.hips.y),this.legLeft=new Point(this.hips.x,this.hips.y),this.kneeRight=new Point(this.legRight.x,this.legRight.y+2*this.head.height),this.kneeLeft=new Point(this.legLeft.x,this.legLeft.y+2*this.head.height),this.footRight=new Point(this.kneeRight.x,this.kneeRight.y+2*this.head.height),this.footLeft=new Point(this.kneeLeft.x,this.kneeLeft.y+2*this.head.height))):(this.shoulderRight=new Point(this.chestCenter.x+this.head.width,this.chestCenter.y-this.head.height/1.5),this.shoulderLeft=new Point(this.chestCenter.x-this.head.width,this.chestCenter.y-this.head.height/1.5),this.armRight=new Point(this.shoulderRight.x+this.head.width/1.5,this.shoulderRight.y+1.4*this.head.height),this.armLeft=new Point(this.shoulderLeft.x-this.head.width/1.5,this.shoulderLeft.y+1.4*this.head.height),this.handRight=new Point(this.armRight.x+this.head.width/1.5,this.armRight.y+1.5*this.head.height),this.handLeft=new Point(this.armLeft.x-this.head.width/1.5,this.armLeft.y+1.5*this.head.height),this.fullbody&&(this.legRight=new Point(this.hips.x+.75*this.head.width,this.hips.y),this.legLeft=new Point(this.hips.x-.75*this.head.width,this.hips.y),this.kneeRight=new Point(this.legRight.x,this.legRight.y+2*this.head.height),this.kneeLeft=new Point(this.legLeft.x,this.legLeft.y+2*this.head.height),this.footRight=new Point(this.kneeRight.x,this.kneeRight.y+2*this.head.height),this.footLeft=new Point(this.kneeLeft.x,this.kneeLeft.y+2*this.head.height))),this.points=[this.neck,this.chestCenter,this.shoulderRight,this.shoulderLeft,this.waist,this.armRight,this.armLeft,this.handRight,this.handLeft,this.hips,this.legRight,this.legLeft,this.kneeRight,this.kneeLeft,this.footRight,this.footLeft]}return a.prototype.segments=function(){var a;return a={neck:[this.neck,this.chestCenter],shoulderRight:[this.chestCenter,this.shoulderRight],shoulderLeft:[this.chestCenter,this.shoulderLeft],armRight:[this.shoulderRight,this.armRight],armLeft:[this.shoulderLeft,this.armLeft],handRight:[this.armRight,this.handRight],handLeft:[this.armLeft,this.handLeft],waist:[this.chestCenter,this.waist],hips:[this.waist,this.hips]},this.fullbody&&$.extend(a,{legRight:[this.hips,this.legRight],legLeft:[this.hips,this.legLeft],kneeRight:[this.legRight,this.kneeRight],kneeLeft:[this.legLeft,this.kneeLeft],footRight:[this.kneeRight,this.footRight],footLeft:[this.kneeLeft,this.footLeft]}),a},a.prototype.isValid=function(a){var b,c;return null!=a.width?(c=a.y+a.height/2,b=a.x+a.width/2):(c=a.y,b=a.x),this.getPixel(Math.round(b),Math.round(c))>0},a.prototype.getPixel=function(a,b){return this.map.data[b*this.map.cols+a]},a.prototype.updateHandLeft=function(a){return this.skeleton&&a&&this.isValid(a)?this.skeleton.handLeft.updateCenter(a):void 0},a.prototype.updateHandRight=function(a){return this.skeleton&&a&&this.isValid(a)?this.skeleton.handRight.updateCenter(a):void 0},a.prototype.seekGradient=function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;if((arguments.length<=6||!f&&!g)&&(f=c.x,g=c.y),3===arguments.length&&(d=0,e=0,h=50),!(h&&0>=h)){if((void 0===h||""+h=="NaN")&&(h=50),r=f,s=g,f=Math.round(f),g=Math.round(g),c.x=f,c.y=g,k=0,l=0,o=d*(2*Math.random()-.1),p=e*(2*Math.random()-.1),0!==d||0!==e){if(q=ImageProcessing.getImageValue(b,f,g),void 0===q)return this.seekGradient(a,b,c,-d,-e,r+o,s+p,h-1);if(30>q)return this.seekGradient(a,b,c,d,e,r-o,s-p,h-1);if(q>240)return this.seekGradient(a,b,c,d,e,r+o,s+p,h-1)}for(B=[-1,1],t=0,x=B.length;x>t;t++)for(n=B[t],C=[f-1,f,f+1],u=0,y=C.length;y>u;u++)m=C[u],q=ImageProcessing.getImageValue(b,m,g+n),q&&(l+=1/n*q/4);for(D=[-1,1],v=0,z=D.length;z>v;v++)for(n=D[v],E=[f-1,f,f+1],w=0,A=E.length;A>w;w++)m=E[w],q=ImageProcessing.getImageValue(b,f+n,m),q&&(k+=1/n*q/4);return i=Math.abs(k),j=Math.abs(l),i>1||j>1?(i>3&&(k=k/i*3),j>3&&(l=l/j*3),this.seekGradient(a,b,c,d,e,r+k,s+l,h-1)):void 0}},a.prototype.centerX=function(a,b,c){var d,e,f,g;if(d=b,e=b,f=c,g=ImageProcessing.getImageValue(a,b,c),g>240){for(;ImageProcessing.getImageValue(a,d,f)>240;)d--;for(;ImageProcessing.getImageValue(a,e,f)>240;)e++}return(d+e)/2},a.prototype.goToTheEnds=function(a,b,c,d,e,f,g,h){var i;return null==f&&(f="x"),null==g&&(g=0),null==h&&(h=0),"x"===f?(i=ImageProcessing.getImageValue(b,parseInt(c.x+d),parseInt(c.y)),i>100?(g=0,c.x+=d):(g++,f="y")):(i=ImageProcessing.getImageValue(b,parseInt(c.x),parseInt(c.y+e)),i>100?(g=0,c.y+=e):(g++,f="x")),g>2||h>320?void 0:this.goToTheEnds(a,b,c,d,e,f,g,h+1)},a.prototype.correlatePoints=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;if(l=this.map,j=this.head,s=this,c=ImageProcessing.erodes(l,2),g=ImageProcessing.dilates(l,2),g=ImageProcessing.blur(g,50),g=ImageProcessing.forEachPixel(g,c,Math.max),g=ImageProcessing.blur(g,20),c=ImageProcessing.erodes(l,4),g=ImageProcessing.forEachPixel(g,c,Math.max),g=ImageProcessing.blur(g,2),segmentation.publishFrameStep("gradient",g.data),a=s.armLeft,b=s.armRight,h=s.handLeft,i=s.handRight,q=s.shoulderLeft,r=s.shoulderRight,d=s.chestCenter,t=s.waist,k=s.hips,o=s.legLeft,p=s.legRight,m=s.kneeLeft,n=s.kneeRight,e=s.footLeft,f=s.footRight,this.seekGradient("chestCenter",g,d),d.x=this.centerX(this.map,d.x,d.y),this.seekGradient("waist",g,t),t.x=this.centerX(this.map,t.x,t.y),this.seekGradient("hips",g,k),k.x=this.centerX(this.map,k.x,k.y),this.side){if(q.x=d.x,r.x=d.x,a.x=this.centerX(this.map,a.x,a.y),b.x=this.centerX(this.map,b.x,b.y),h.x=this.centerX(this.map,h.x,h.y),i.x=this.centerX(this.map,i.x,i.y),this.fullbody)return o.x=this.centerX(this.map,o.x,o.y),p.x=this.centerX(this.map,p.x,p.y),m.x=this.centerX(this.map,m.x,m.y),n.x=this.centerX(this.map,n.x,n.y),e.x=this.centerX(this.map,e.x,e.y),f.x=this.centerX(this.map,f.x,f.y)}else if(this.seekGradient("sholderLeft",g,q,-.1,-.2),this.seekGradient("sholderRight",g,r,.1,-.2),q.y+=j.height/5,r.y+=j.height/5,d.x=(q.x+r.x)/2,h.x=q.x,h.y=q.y,i.x=r.x,i.y=r.y,this.goToTheEnds("handLeft",l,h,-1,2),this.goToTheEnds("handRight",l,i,1,2),this.seekGradient("handLeft",g,h,-.5,2),this.seekGradient("handRight",g,i,.5,2),this.seekGradient("armLeft",g,a,0,0,(q.x+h.x)/2,(q.y+h.y)/2,2),this.seekGradient("armRight",g,b,0,0,(r.x+i.x)/2,(r.y+i.y)/2,2),this.fullbody)return this.seekGradient("legLeft",g,o,-1,0),o.x=o.x+(k.x-o.x)/4,this.seekGradient("legRight",g,p,1,0),p.x=p.x-(p.x-k.x)/4,k.x=(o.x+p.x)/2,e.x=o.x,e.y=o.y,this.goToTheEnds("footLeft",l,e,-2,3,"y"),this.seekGradient("footLeft",g,e,-1,2),this.seekGradient("kneeLeft",g,m,0,0,(e.x+o.x)/2,(e.y+o.y)/2,2),f.x=p.x,f.y=p.y,this.goToTheEnds("footRight",l,f,2,3,"y"),this.seekGradient("footRight",g,f,1,2),this.seekGradient("kneeRight",g,n,0,0,(f.x+p.x)/2,(f.y+p.y)/2,2)},a}()}.call(this),function(){this.Color=function(){function a(a,b,c,d){this.red=a,this.green=b,this.blue=c,this.alpha=d}return a.prototype.difference=function(a){var b,c;return b=ImageProcessing.convertRGBtoHSV(this.red,this.green,this.blue),c=ImageProcessing.convertRGBtoHSV(a.red,a.green,a.blue),Math.abs(b.h-c.h)<.05&&Math.abs(b.v-c.v)<.3?0:2048*(Math.pow(Math.abs(Math.abs(b.h-1)-Math.abs(c.h-1)),.6)*Math.abs(b.v-c.v))*(1-b.s*c.s*b.v*c.v)},a.prototype.to_s=function(){return this.red+","+this.green+","+this.blue},a}(),this.Segmentation=function(){function a(a,b){this.canvas=a,this.video=b,this.w=this.canvas.width,this.h=this.canvas.height,this.ctx=this.canvas.getContext("2d"),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.bgCaptures=20,this.threshold=88,this.adjustMutiplier=.8,this.applyFlood=!0,this.floodLimit=50,this.colorThreshold=1.7,this.debug="localhost"===window.location.hostname,this.debug&&$(".dg.ac").show(),this.dilates0=0,this.erodes=2,this.dilates=2,this.blurSize=0,this.viewMode=0,this.bgPixelsList=[],this.bgColorsList=[],this.bgSignificanceList=[],this.bgGrayList=[],this.faceHaarOptions={scale_factor:1.1,step:1},this.handHaarOptions={scale_factor:1.1,step:1},this.canny=!0,"undefined"!=typeof gui&&null!==gui&&this.setupGui()}return a.prototype.fillImageOnMatrix=function(a){var b,c,d,e,f;for(c=ImageProcessing.matrix(this.w,this.h),b=e=0,f=a.length;f>e;b=++e)d=a[b],c[b]=d;return c},a.prototype.proccessColor=function(a){var b,c,d,e,f,g,h;for(e=ImageProcessing.matrix(this.w,this.h),g=[],f=e.data.length,c=h=0;f>=0?f>=h:h>=f;c=f>=0?++h:--h)d=4*c,b=ImageProcessing.convertRGBtoHSV(a[d],a[d+1],a[d+2]),e.data[c]=255*b.h,g[c]=b.s;return[e,g]},a.prototype.getDifferenceValues=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K;for(l=0,h=0,n=255,u=255,x=this.bgGrayList.length,v=4*e,z=[],m=0,w=E=0;3>E;w=++E)h=this.bgPixelsList[1].data[v+w],q=a[v+w],z[w]=127+h-q;if(y=z[0],t=z[1],g=z[2],A=Math.abs(y-t)+Math.abs(y-g)+Math.abs(t-g),A=Math.abs(127-4*A)/6,A>255&&(A=255),A=213*Math.sqrt(A/255),q=d.data[e],r=q,q>=this.bgGrayList[0].data[e]&&q<=this.bgGrayList[1].data[e])n=0;else for(J=this.bgGrayList,F=0,H=J.length;H>F;F++)j=J[F],h=j.data[e],o=q-h,m=Math.min(m,o),n=Math.min(n,Math.abs(o));for(j=h,q=b.data[e],s=c[e],q=Math.abs(q-127),k=Math.min(this.bgSignificanceList[0][e],this.bgSignificanceList[1][e]),K=this.bgColorsList,G=0,I=K.length;I>G;G++)i=K[G],h=i.data[e],h=Math.abs(h-127),f=q-h,0>f&&(f=0),u=Math.min(u,3.3*Math.abs(f));return C=0,D=255*Math.abs(s-k),p=(.5-Math.abs(j/255-.5))*(.5-Math.abs(r/255-.5)),B=26*D*p,l=0,n=465*Math.sqrt(Math.max(0,n-30)/100),l=(n+u+B+A+D)/1.5,l=Math.max(l,n*u*B*A/5e3),l=255*Math.pow(l/200,2),0>l?l=0:l>150&&(l=150),n>150&&500>n&&-40>m&&90>D&&B>=3&&150>B&&(l-=250),l+100},a.prototype.limitValue=function(a){return a>255?255:0>a?0:a},a.prototype.pixelDifferenceFunction=function(){var a;return a=this,function(b,c,d,e,f){return a.limitValue(a.getDifferenceValues(b,c,d,e,f))}},a.prototype.calculateAdjust=function(a){var b,c,d,e,f,g,h,i;for(b=0,e=a.data.length,d=i=0;e>=0?e>=i:i>=e;d=e>=0?++i:--i)g=d%this.w,h=d/this.w,f=this.h/6,f>=h&&(f>=g||g>=this.w-f)&&(c=a.data[d],b=Math.max(b,c));return b},a.prototype.imageDifference=function(a,b,c,d,e){var f,g,h;return g=this.pixelDifferenceFunction(),h=ImageProcessing.imageDifference(a,b,c,d,g,0,e),this.publishFrameStep("original Diff",h.data),f=this.calculateAdjust(h)*this.adjustMutiplier,h=ImageProcessing.imageDifference(a,b,c,d,g,f)},a.prototype.floodFill=function(a,b,c,d,e){var f,g,h;return h=b[e],g=ImageProcessing.getColor(a,c,d,this.w),f=this.colorThreshold,4===a.channel&&(this.colorThreshold=0),this.floodFill4(a,b,c+1,d,g,h,0,this.colorThreshold),this.floodFill4(a,b,c-1,d,g,h,0,this.colorThreshold),this.floodFill4(a,b,c,d+1,g,h,0,this.colorThreshold),this.floodFill4(a,b,c,d-1,g,h,0,this.colorThreshold),this.colorThreshold=f},a.prototype.flood=function(a,b){var c,d,e,f,g,h;if(this.applyFlood){for(h=[],d=f=0,g=this.w;g>=0?g>=f:f>=g;d=g>=0?++f:--f)h.push(function(){var f,g,h;for(h=[],e=f=0,g=this.h;g>=0?g>=f:f>=g;e=g>=0?++f:--f)c=e*this.w+d,b.data[c]>this.threshold?h.push(this.floodFill(a,b.data,d,e,c)):h.push(void 0);return h}.call(this));return h}},a.prototype.floodFill4=function(a,b,c,d,e,f,g,h){var i,j,k,l;if(!(!this.applyFlood||c>this.w||d>this.h||0>d||0>c||g>this.floodLimit))return k=d*this.w+c,l=b[k],f>l&&(i=ImageProcessing.getColor(a,c,d,this.w),j=i.difference(e),h>j&&(b[k]=f,g<this.floodLimit))?(this.floodFill4(a,b,c+1,d,e,f,g+1,h),this.floodFill4(a,b,c-1,d,e,f,g+1,h),this.floodFill4(a,b,c,d+1,e,f,g+1,h),this.floodFill4(a,b,c,d-1,e,f,g+1,h)):void 0},a.prototype.applyViewMode=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(1===this.viewMode){for(m=[],c=e=0,i=a.data.length;i>=e;c=e+=4)d=b[c/4],m.push(a.data[c]=a.data[c+1]=a.data[c+2]=d);return m}if(2===this.viewMode){for(n=[],c=f=0,j=a.data.length;j>=f;c=f+=4)d=b[c/4]/255,0>d&&(d=0),d>255&&(d=255),a.data[c]*=d,a.data[c+1]*=d,n.push(a.data[c+2]*=d);return n}if(3===this.viewMode){for(o=[],c=g=0,k=a.data.length;k>=g;c=g+=4)d=255-b[c/4],0>d&&(d=0),d>255&&(d=255),a.data[c]+=d,a.data[c+1]+=d,o.push(a.data[c+2]+=d);return o}if(4===this.viewMode){for(p=[],c=h=0,l=a.data.length;l>=h;c=h+=4)d=255-b[c/4],0>d&&(d=0),d>255&&(d=255),d>0?(a.data[c]=this.bgPixelsList[0].data[c],a.data[c+1]=this.bgPixelsList[0].data[c+1],p.push(a.data[c+2]=this.bgPixelsList[0].data[c+2])):(a.data[c]+=d,a.data[c+1]+=d,p.push(a.data[c+2]+=d));return p}},a.prototype.refreshVideo=function(a,b){return null==a&&(a=this.ctx),null==b&&(b=!1),b?(a.canvas.scale(-1,1),ct.canvas.drawImage(v,0,0,-1*a.canvas.width,a.canvas.height),canvas.restore()):a.drawImage(this.video,0,0,a.canvas.width,a.canvas.height)},a.prototype.getCameraImage=function(a,b){return null==b&&(b=this.ctx),this.refreshVideo(b),this.getImage(b)},a.prototype.clearWith=function(a,b){return null==b&&(b=this.ctx),b.putImageData(a,0,0)},a.prototype.feedBackgroundImages=function(a,b){var c,d,e,f,g,h;return this.bgGrayList=a,this.bgPixelsList=b,g=this.proccessColor(this.bgPixelsList[0].data),d=g[0],f=g[1],h=this.proccessColor(this.bgPixelsList[1].data),c=h[0],e=h[1],this.bgColorsList=[d,c],this.bgSignificanceList=[f,e]},a.prototype.publishFrameStep=function(a,b,c,d){var e,f,g,h,i,j,k;if(this.debug!==!1){if(e=document.createElement("canvas"),e.width=this.w,e.height=this.h,$(e).addClass("thumb"),$(e).attr("title",a),f=e.getContext("2d"),b.constructor===ImageData)g=b;else for(g=this.getImage(),h=j=0,k=e.width*e.height*4;k>=j;h=j+=4)i=b[h/4],c&&(i=2*Math.abs(i-127)),d&&(i*=255),g.data[h]=i,g.data[h+1]=i,g.data[h+2]=i,g.data[h+3]=255;return f.putImageData(g,0,0),f.font="12px Verdana",f.fillStyle="red",f.fillText(a,0,15),$(".frames").append(e)}},a.prototype.getImage=function(a){return null==a&&(a=this.ctx),a.getImageData(0,0,a.canvas.width,a.canvas.height)},a.prototype.findFace=function(a){var b;return null==a&&(a=this.canvas),b=ImageProcessing.findFace(a,this.faceHaarOptions,this.canny),b&&b.length>0&&b[4]>4?(this.head={x:b[0],y:b[1],width:b[2],height:1.2*b[3],data:b},this.head):void 0},a.prototype.findHandFist=function(a){return ImageProcessing.findHandFist(a,this.handHaarOptions,this.canny)},a.prototype.findHandOpen=function(a){return ImageProcessing.findHandOpen(a,this.handHaarOptions,this.canny)},a.prototype.proccess=function(a){var b,c,d,e,f,g,h,i,j,k;return $(".frames").empty(),f=null,this.bgGrayList.length>0?(this.publishFrameStep("bgPixels min",this.bgPixelsList[0]),this.publishFrameStep("bgColors min",this.bgColorsList[0].data,!0),this.publishFrameStep("bgCSignificance min",this.bgSignificanceList[0],!1,!0),this.publishFrameStep("Background Gray min",this.bgGrayList[0].data),
this.publishFrameStep("bgPixels MAX",this.bgPixelsList[1]),this.publishFrameStep("bgColors MAX",this.bgColorsList[1].data,!0),this.publishFrameStep("bgCSignificance MAX",this.bgSignificanceList[1],!1,!0),this.publishFrameStep("Background Gray MAX",this.bgGrayList[1].data),a||(a=this.getImage()),k=this.proccessColor(a.data),d=k[0],i=k[1],this.publishFrameStep("currentImage",a),this.publishFrameStep("currentImageColors",d.data,!0),this.publishFrameStep("currentImageCSignificance",i,!1,!0),h=a.data,f=ImageProcessing.grayBlurData(a,this.blurSize),this.publishFrameStep("currentImageGray",f.data),g=f.data.length,e=this.imageDifference(h,d,i,f),this.publishFrameStep("imageDiff",e.data),j=new Slic(a,{regionSize:20,minRegionSize:16}),this.publishFrameStep("slic",j.result.data),c=j.clusters,this.floodCluster(e,c),this.publishFrameStep("flooded",e.data),e=ImageProcessing.normalize(e),this.publishFrameStep("normalized",e.data),b=ImageProcessing.dupImageGray(e),e=ImageProcessing.applyThreshold(e,this.threshold),this.publishFrameStep("final-mask",e.data),this.applyViewMode(a,e.data),this.publishFrameStep("imageData",a),this.imageData=a,this.imageDiff=e,this.auxDiff=b):(a=this.getImage(),this.imageData=a,this.imageDiff=ImageProcessing.matrix(this.w,this.h)),[a,this.imageDiff,f,this.auxDiff]},a.prototype.floodCluster=function(a,b){var c,d,e,f,g,h,i,j;for(j=[],f=0,h=b.length;h>f;f++){for(d=b[f],c=0,g=0,i=d.length;i>g;g++)e=d[g],c+=a.data[e]/(d.length+1);j.push(function(){var b,f,g;for(g=[],b=0,f=d.length;f>b;b++)e=d[b],g.push(a.data[e]=c);return g}())}return j},a.prototype.clearCanvas=function(){return this.ctx.clearRect(0,0,this.w,this.h)},a.prototype.setupGui=function(){var a;return a=gui.addFolder("Segmentation"),a.add(this,"debug"),a.add(this,"viewMode",0,4),a.add(this,"threshold",0,255),a.add(this,"adjustMutiplier",0,1).step(.1),a=gui.addFolder("Image Transform"),a.add(this,"applyFlood"),a.add(this,"dilates0",0,10),a.add(this,"erodes",0,10),a.add(this,"dilates",0,10),a.add(this,"blurSize",0,1),a=gui.addFolder("Face detector"),a.add(this.faceHaarOptions,"scale_factor",0,5).step(.05),a.add(this.faceHaarOptions,"step",0,5).step(1),a=gui.addFolder("Hand detector"),a.add(this.handHaarOptions,"scale_factor",0,5).step(.05),a.add(this.handHaarOptions,"step",0,5).step(1)},a}()}.call(this),function(){this.CanvasPreview=function(){function a(b,c){this.ctxImage=b,this.ctx=null!=c?c:this.ctxImage,this.mirrorCamera=!0,this.scale=1,this.setDefaultStyle(),"undefined"!=typeof gui&&null!==gui&&a.setupGUI(),this.loadSiluettes()}return a.conf={drawSkeleton:!1,drawMeasurements:!0},a.setupGUI=function(){var a,b,c,d;if(null==this.fold){this.fold=gui.addFolder("View"),c=this.conf,d=[];for(a in c)b=c[a],d.push(this.fold.add(this.conf,a));return d}},a.prototype.clear=function(){return this.ctxImage.clearRect(0,0,this.ctxImage.canvas.width,this.ctxImage.canvas.height)},a.prototype.clearWith=function(a){return this.ctxImage.putImageData(a,0,0)},a.prototype.drawCirc=function(a,b,c,d){return null==c&&(c=10),null==d&&(d=this.style),a*=this.scale,b*=this.scale,this.ctx.shadowColor=d.circShadowColor,this.ctx.fillStyle=d.circFillColor,this.ctx.strokeStyle=d.circColor,this.ctx.lineWidth=d.lineWidth,this.ctx.beginPath(),this.ctx.arc(a,b,c,0,2*Math.PI,!1),this.ctx.stroke(),this.ctx.fill(),this.ctx.closePath()},a.prototype.drawRect=function(a,b){var c,d,e,f;return e=a[0]*this.scale,f=a[1]*this.scale,d=a[2]*this.scale,c=a[3]*this.scale,this.ctx.shadowColor=this.style.shadowColor,this.ctx.fillStyle=b||this.style.rectColor,this.ctx.strokeStyle=b||this.style.rectFillColor,this.ctx.lineWidth=this.style.lineWidth,this.ctx.beginPath(),this.ctx.rect(e,f,d,c),this.ctx.fill(),this.ctx.stroke()},a.prototype.drawText=function(a,b,c){return b*=this.scale,c*=this.scale,this.ctx.shadowColor=this.style.shadowColor,this.ctx.fillStyle=this.style.textColor,this.ctx.lineWidth=this.style.lineWidth,this.ctx.fillText(a,b,c)},a.prototype.drawPoint=function(a){var b,c;return c={circShadowColor:this.style.circShadowColor,circFillColor:this.style.pointFillColor,circColor:this.style.pointColor,lineWidth:this.style.lineWidth},b=this.style.pointSize||1,this.drawCirc(a.x,a.y,a.radius*b,c)},a.prototype.drawLineFromPoints=function(a,b){var c,d,e,f;return c=a.x*this.scale,d=a.y*this.scale,e=b.x*this.scale,f=b.y*this.scale,this.ctx.shadowColor=this.style.shadowColor,this.ctx.strokeStyle=this.style.lineColor,this.ctx.lineWidth=this.style.lineWidth,this.ctx.beginPath(),this.ctx.moveTo(c,d),this.ctx.lineTo(e,f),this.ctx.stroke(),this.ctx.closePath()},a.prototype.loadSiluettes=function(){var a,b,c,d,e,f,g,h,i;for(this.siluettes={},this.manikins={},h=["side","front"],i=[],f=0,g=h.length;g>f;f++)d=h[f],i.push(function(){var f,g,h,i;for(h=["m","f"],i=[],f=0,g=h.length;g>f;f++)a=h[f],e="/images/siluette_"+a+"_"+d+".png",b=new Image,b.src=e,this.siluettes[e]=b,c="/images/manikin_"+a+"_"+d+".png",b=new Image,b.src=c,i.push(this.manikins[c]=b);return i}.call(this));return i},a.prototype.drawSiluette=function(a,b,c){var d,e,f,g,h,i;return d=b.gender.toLowerCase(),g="/images/siluette_"+d+"_"+(c?"side":"front")+".png",f=a[3]/30,h=(a[0]-55*f)*this.scale,i=(a[1]-15*f)*this.scale,e=this.siluettes[g],null!=e?this.ctx.drawImage(e,h,i,e.width*f*this.scale,e.height*f*this.scale):void 0},a.prototype.drawManikin=function(a,b){var c,d,e,f,g;return c=a.gender.toLowerCase(),e="/images/manikin_"+c+"_"+(b?"side":"front")+".png",d=this.manikins[e],null!=d?(f=null!=(g=this.mirrorCamera)?g:{20:this.ctx.canvas.width-20},this.ctx.drawImage(d,f,5,.3*d.width,.3*d.height)):void 0},a.prototype.plotSkeleton=function(b){var c,d,e,f,g,h,i;if(a.conf.drawSkeleton){this.setStyleSkeleton(),g=this,h=b.segments(),i=[];for(d in h)f=h[d],c=null,i.push(function(){var a,b,h;for(h=[],a=0,b=f.length;b>a;a++)e=f[a],null!==c&&(g.drawLineFromPoints(c,e),g.drawText(d,e.x,e.y-e.radius)),g.drawPoint(e),h.push(c=e);return h}());return i}},a.prototype.plotMeasurement=function(b,c){var d,e,f,g,h,i,j,k,l,m;if(a.conf.drawMeasurements){for(h=this,d=null,g=b.points,j=0,l=g.length;l>j;j++)e=g[j],null!==d&&h.drawLineFromPoints(d,e),d=e;for(k=0,m=g.length;m>k;k++)e=g[k],e===c?(i=$.extend({},this.style),this.setStyleMoving(),this.drawPoint(e),this.style=i):this.drawPoint(e);return f=g[0],null!=f?h.drawText(b.text(),f.x,f.y-f.radius):console.error("measure without points? ",b,g)}},a.prototype.setDefaultStyle=function(){return this.style={},this.style.textColor="#00a9c1",this.style.lineWidth=2,this.style.lineColor="#ddcf21",this.style.pointColor="#ddcf21",this.style.pointFillColor="#ddcf21",this.style.rectColor="#ddvf21",this.style.rectFillColor="#ddvf21",this.style.circColor="#ddvf21",this.style.circFillColor="#ddvf21",this.style.shadowColor="rgba(0,0,0,0.75)",this.style.circShadowColor="rgba(0,0,0,0.25)",this.style.shadowBlur=3,this.style.pointSize=1,this.ctx.fillStyle=this.style.textColor,this.ctx.lineWidth=this.style.lineWidth,this.ctx.strokeStyle=this.style.lineColor,this.ctx.shadowColor=this.style.shadowColor,this.ctx.shadowBlur=this.style.shadowBlur,this.ctx.textBaseline="bottom",this.ctx.textAlign="center"},a.prototype.setStyleReference=function(){return this.style.textColor="#fff",this.style.lineWidth=2,this.style.lineColor="#00a9c1",this.style.pointColor="#00a9c1",this.style.pointFillColor="#00a9c1",this.style.pointSize=1},a.prototype.setStyleMoving=function(){return this.style.textColor="#00a9c1",this.style.lineWidth=2,this.style.lineColor="#00a9c1",this.style.pointColor="#00a9c1",this.style.pointFillColor="#00a9c1",this.style.pointSize=1},a.prototype.setStyleActive=function(){return this.style.textColor="#fff",this.style.lineWidth=2,this.style.lineColor="#fff",this.style.pointColor="#fff",this.style.pointFillColor="#fff",this.style.pointSize=4},a.prototype.setStyleSkeleton=function(){return this.style.textColor="#000",this.style.lineWidth=2,this.style.lineColor="#fff",this.style.pointColor="#fff",this.style.pointFillColor="#fff",this.style.pointSize=1},a.prototype.thumbnailTo=function(a){var b,c,d;return b=a.getContext("2d"),b.scale(1,1),d=a.width/this.ctxImage.canvas.width,c=new Image,c.onload=function(){return b.scale(d,d),b.drawImage(c,0,0)},c.src=this.ctxImage.canvas.toDataURL()},a.prototype.zoom=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;for(null==b&&(b=2),null==c&&(c=200),t=this,d=b+1,s=10,u=parseInt(a.x*this.scale),v=parseInt(a.y*this.scale),g=0,h=0,r=parseInt(c/b),u+c>this.ctx.canvas.width?(g=-(u+c-this.ctx.canvas.width)-4*a.radius,h=v>this.ctx.canvas.height/2?-c/2-2*a.radius-s:c/2+2*a.radius+s):v+c/2>this.ctx.canvas.height&&(h+=-(v+c/2-this.ctx.canvas.height)-2*a.radius+s),i=parseInt(r/2),k=this.ctxImage.getImageData(0,0,this.ctxImage.canvas.width,this.ctxImage.canvas.height),k=this.ctxImage.getImageData(0,0,this.ctxImage.canvas.width,this.ctxImage.canvas.height),l=this.ctx.getImageData(0,0,this.ctx.canvas.width,this.ctx.canvas.height),p=[],q=[],j=w=0;r>=0?r>=w:w>=r;j=r>=0?++w:--w)for(p[j]=[],q[j]=[],m=x=0;r>=0?r>=x:x>=r;m=r>=0?++x:--x)p[j][m]=ImageProcessing.getColor(k,u+j-i,v+m-i,this.ctxImage.canvas.width),q[j][m]=ImageProcessing.getColor(l,u+j-i,v+m-i,this.ctx.canvas.width);for(A=[],j=y=0,z=p.length;z>y;j=++y)n=p[j],A.push(function(){var i,k,l;for(l=[],m=i=0,k=n.length;k>i;m=++i)o=n[m],e=u+s+j*b+a.radius+g,f=v+m*b-c/2+h,255===q[j][m].alpha?t.ctx.fillStyle="rgb("+q[j][m].to_s()+")":t.ctx.fillStyle="rgb("+o.to_s()+")",t.ctx.shadowBlur=0,l.push(t.ctx.fillRect(e,f,d,d));return l}());return A},a}()}.call(this),function(){var a,b,c;this.Wear=function(){function a(a,b,c){this.name=a,this.spec=b,this.measures=c}return a.prototype.genderString=function(){return"M"===this.spec.gender?"Masculina":"Feminina"},a.prototype.status=function(){return this.distanceFirst&&this.distanceLast?this.distanceFirst<0&&this.distanceLast<0?"apertado":this.distanceFirst>0&&this.distanceLast<0?"ok":"folgado":"sem model"},a}(),this.Measure=function(){function a(){}return a.round=function(a,b,c){var d,e;return null==a||null==b||null==c?void console.log("missing part? "+a+", front? "+b+", side? "+c):null==b[a]?void console.log("missing front "+a,b):null==c[a]?void console.log("missing side "+a,c):(d=b[a].value(),e=c[a].value(),Math.PI*Math.sqrt((d*d+e*e)/2))},a}(),this.Fit=function(){function a(a){this.models=a}return a.prototype.match=function(a,b){var c,d,e,f,g,h,i,j,k,l;if(null!=a&&null!=b){f={};for(i in this.models[0].measures)c=/(front|side)[A-Z]/.exec(i),c?(e=i.replace(c[1],"").toLowerCase(),"front"===c[1]?f[i]=a[e].value():f[i]=b[e].value()):f[i]=Measure.round(i,a,b);for(l=this.models,j=0,k=l.length;k>j;j++){g=l[j],g.distance=0,g.distanceReal=0,g.distanceOf={},g.distanceFirst=0,g.distanceLast=0,g.fitRange=0;for(i in f)d=f[i],null!=d&&(h=g.measures[i],h instanceof Array||(h=[h]),g.distanceFirst+=h[0]-d,h.lengh>1?(g.distanceLast+=h[1]-d,g.fitRange+=Math.abs(h[1]-h[0])):g.fitRange+=3,g.distanceOf[i]=g.distanceFirst+g.distanceLast,g.distance+=Math.abs(g.distanceOf[i]),g.distanceReal+=g.distanceOf[i]);g.description=this.descriptionFor(g),g.color=this.color(g.distance)}return this.models.sort(function(a,b){return a.distance-b.distance})}},a.prototype.color=function(a){var b,c,d,e,f;return e=.35-Math.abs(a)/50,0>e&&(e=0),e>1&&(e=1),f=ImageProcessing.convertHSVtoRGB(e,1,1),d=f.r,c=f.g,b=f.b,"rgb("+d+", "+c+", "+b+")"},a.prototype.descriptionFor=function(a,b,c){return a.distanceReal<-a.fitRange?"apertada":a.distanceReal>a.fitRange?"frouxa":"serve"},a}(),this.WearRule=function(){function a(a,b){this.container=null!=a?a:$("#rule-container")[0],this.element=null!=b?b:$("#rule-current-value")[0],this.zero=42,this.percent=0,this.margin=5,this.maxSize=280}return a.prototype.updateRule=function(a){return this.percent=a,this.element.style.left=""+(this.zero+parseInt(this.percent*this.maxSize/100))+"px"},a}(),a=function(a,b,c){return new Wear("Camisa",{gender:"M",type:"shirt",size:{br:a}},{frontTrunk:b,bust:c})},b=function(a,b,c){return a={br:a,eua:""+c.bust[0]/2+"-"+c.bust[1]/2},new Wear("Camiseta / Blusa",{gender:"M",type:"tshirt",manikin:a,size:{br:b[0],en:b[1]}},c)},c=function(a,b,c){return a={br:a,eua:a},new Wear("Blusas e malhas",{gender:"F",type:"shirt",manikin:a,size:{br:b[0],en:b[1]}},c)},window.wear={kanui:{M:{shirt:new Fit([a(1,["P","XD"],[165,175],[88,94]),a(2,["M1","S"],[170,180],[94,100]),a(3,["M2","M"],[170,180],[100,106]),a(4,["M3","L"],[170,180],[106,112]),a(5,["G","XL"],[175,190],[108,114]),a(6,["GG","XXL"],[175,190],[112,118])]),tshirt:new Fit([b(1,["PP","XD"],{bust:[80,84],frontShoulders:40}),b(2,["P","S"],{bust:[88,92],frontShoulders:42}),b(3,["M","M"],{bust:[96,100],frontShoulders:44}),b(4,["G","L"],{bust:[104,108],frontShoulders:48}),b(5,["GG","XL"],{bust:[112,116],frontShoulders:50}),b(6,["EG","XXL"],{bust:[120,124],frontShoulders:52})])},F:{shirt:new Fit([c("34",["PP","XD"],{frontShoulders:[30,34],waist:[56,60],hips:[83,90],bust:[73,80]}),c("36-38",["P","S"],{frontShoulders:[35,36],waist:[64,68],hips:[90,97],bust:[80,87]}),c("40-42",["M","M"],{frontShoulders:[37,38],waist:[72,76],hips:[98,105],bust:[88,96]}),c("44-46",["G","L"],{frontShoulders:[44,46],waist:[80,84],hips:[106,115],bust:[97,104]}),c("48-50",["GG","XL"],{frontShoulders:[48,50],waist:[88,89],hips:[115,118],bust:[105,115]})])}}}}.call(this),function(){var a;this.Point=function(){function a(a,b,c,d){this.x=a,this.y=b,this.radius=null!=c?c:.5,this.measurement=d}return a.prototype.isOver=function(a,b,c){var d;return null==c&&(c=1),a/=c,b/=c,d=Math.pow(this.radius,2),10>d&&(d=10),Math.pow(a-this.x,2)+Math.pow(b-this.y,2)<d},a.prototype.updateCenter=function(a){return this.x=a.x+a.width/2,this.y=a.y+a.height/2},a.prototype.updateXY=function(a,b,c){return this.x=a,this.y=b,null==c&&(c=1),this.x/=c,this.y/=c},a.prototype.updateMeasurement=function(){var a;return null!=(a=this.measurement)?a.pointChanged(this):void 0},a.prototype.bindMeasurement=function(a){return this.measurement=a,this},a}(),a=function(){function a(a,b){this.scale=null!=a?a:1,this.unity=null!=b?b:"px"}return a.prototype.change=function(a,b){this.scale=a,this.unity=b},a}(),this.Measurement=function(){function a(a,b,c,d){var e,f,g,h;for(this.name=a,this.scale=b,this.perpendicular=null!=d?d:!0,null!=t.measures[this.name]?(h=t.measures[this.name],this.label=h.label,this.description=h.description):console.error("couldn't find locale for measures."+this.name),this.points=[],f=0,g=c.length;g>f;f++)e=c[f],this.points.push(new Point(e.x,e.y,.5,this))}return a.prototype.text=function(){var a,b;return this.scale&&this.scale.scale>0?""+this.label+": "+this.value(null!=(a=this.scale)?a.scale:void 0)+(null!=(b=this.scale)?b.unity:void 0):this.label},a.prototype.value=function(a){return null==a&&(a=this.scale.scale),1!==a&&null!=this.realMeasurement?this.realMeasurement:this.points.reduce(function(b,c){return~~(100*a*Math.sqrt(Math.pow(b.x-c.x,2)+Math.pow(b.y-c.y,2)))/100})},a.prototype.bindBone=function(a,b){var c,d,e,f;return this.startBone=a,this.endBone=b,d=this.endBone.y-this.startBone.y,c=this.endBone.x-this.startBone.x,0===c&&(c=.1),this.boneAngle=Math.atan2(d,c),this.m=d/c,f=this.startBone.y,e=this.startBone.x,this.aBone=this.m,this.bBone=-this.m*e+f,this},a.prototype.boneFunction=function(a){return this.aBone*a-this.bBone},a.prototype.otherPoint=function(a){return this.points[0]===a?this.points[1]:this.points[0]},a.prototype.pointChanged=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o;return this.perpendicular?(c=this.boneAngle?this.boneAngle-Math.PI/2:0,h=Math.tan(c),b=h,d=-h*a.x+a.y,j=(this.bBone-d)/(b-this.aBone),m=this.boneFunction(j),this.fx=function(a){return b*a+d},this.fy=function(a){return(a-d)/b},this.iterateX=1>=b,i=this.otherPoint(a),e=-h*i.x+i.y,k=(this.bBone-e)/(b-this.aBone),n=this.boneFunction(k),g=n-m,f=k-j,l=i.x-f,o=i.y-g,i.x=l,i.y=o):void 0},a.prototype.compute=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;if(this.pointChanged(this.points[0]),k={x:(this.points[0].x+this.points[1].x)/2,y:(this.points[0].y+this.points[1].y)/2},isNaN(k.x)||isNaN(k.y))return void console.log("NaN",this.label,this);for(x=this.points,v=0,w=x.length;w>v;v++){for(m=x[v],t=m.x,this.iterateX?(q="x",g=this.fx,h=function(a,b){return[a,b]}):(q="y",g=this.fy,h=function(a,b){return[b,a]}),o=(k[q]+m[q])/2,e=Math.abs(m[q]-k[q]),p=function(a,b){return a+b},l=function(a){return a+1},n=function(a){return a-1},s=function(a){return o>a},null!=d&&(o=Math.max(o,d[1]||0)),m[q]<k[q]&&(null!=d&&(o=Math.min(o,d[0]||1e4)),p=function(a,b){return a-b},l=function(a){return a-1},n=function(a){return a+1},s=function(a){return a>o}),f=parseInt(p(m[q],e)),j=parseInt(o);j!==f&&(i=parseInt(g(t)),y=h(j,i),t=y[0],u=y[1],r=ImageProcessing.getImageValue(b,t,u),0!==r);)j=l(j);for(;j!==parseInt(k[q])&&s(j)&&(i=parseInt(g(t)),z=h(j,i),t=z[0],u=z[1],r=ImageProcessing.getImageValue(b,t,u),!(r>0));)j=n(j);m.x=p(t,-.5),m.y=g(t)}return this},a}(),this.Measurements=function(){function b(b,c,d,e){this.ctx=b,this.w=c,this.h=d,this.side=e,this.currentScale=new a(1,"px"),this.reference=new Measurement("reference",this.currentScale,[{x:50,y:120},{x:50,y:180}],!1)}return b.prototype.showMeasureHelp=function(){return UI.showMeasureDescription(t.measures[this.selectedMeasurement].description)},b.prototype.hideMeasureHelp=function(){return UI.showMeasureDescription("")},b.prototype.trunk=function(a){var b,c;return b=this.humanBody.skeleton,c=b.neck.x-this.humanBody.head.width/2,new Measurement("trunk",this.currentScale,[{x:c,y:b.neck.y},{x:c,y:b.hips.y}],!1)},b.prototype.widthLimits=function(a){var b,c,d,e,f,g,h,i,j,k,l,m;for(e=0,g=0,h=0,i=0,j=0,d=0,c=0,b=k=0,l=this.h/2;l>=0?l>=k:k>=l;b=l>=0?++k:--k){for(d=b*this.w,f=0;0===a.data[d+f]&&f<this.w;)f++;for(c=f;0!==a.data[d+c]&&c<this.w;)c++;c-f>e&&(e=c-f,m=[f,c,b],g=m[0],h=m[1],i=m[2])}return g>0&&h>0&&i>0?new Measurement("width",this.currentScale,[{x:g,y:i},{x:h,y:i}],!1):void 0},b.prototype.humanHips=function(a){return new Measurement("hips",this.currentScale,[{x:this.skeleton.hips.x-this.skeleton.head.width,y:this.skeleton.hips.y},{x:this.skeleton.hips.x+this.skeleton.head.width,y:this.skeleton.hips.y}],!0).bindBone(this.skeleton.waist,this.skeleton.hips).compute(this.skeleton,a)},b.prototype.humanWaist=function(a){return new Measurement("waist",this.currentScale,[{x:this.skeleton.waist.x-this.skeleton.head.width,y:this.skeleton.waist.y},{x:this.skeleton.waist.x+this.skeleton.head.width,y:this.skeleton.waist.y}]).bindBone(this.skeleton.chestCenter,this.skeleton.hips).compute(this.skeleton,a,this.humanBody.waistLimits())},b.prototype.humanBust=function(a){var b;return b=new Point(this.skeleton.head.x+this.skeleton.head.width/2,this.skeleton.head.y),new Measurement("bust",this.currentScale,[{x:this.skeleton.chestCenter.x-this.skeleton.head.width,y:1.05*this.skeleton.chestCenter.y},{x:this.skeleton.chestCenter.x+this.skeleton.head.width,y:1.05*this.skeleton.chestCenter.y}]).bindBone(b,this.skeleton.waist).compute(this.skeleton,a)},b.prototype.humanRightWrist=function(a){var b,c,d,e,f,g;return c=this.skeleton.armRight,f=this.skeleton.handRight,b=Math.atan2(f.y-c.y,f.x-c.x),g=this.skeleton.head.width/4,d=Math.sin(b)*g,e=Math.cos(b)*g,new Measurement("right_wrist",this.currentScale,[{x:f.x-d,y:f.y-e},{x:f.x+d,y:f.y+e}],!0).bindBone(c,f).compute(this.skeleton,a)},b.prototype.humanShoulders=function(a){var b;return b=new Point(this.skeleton.head.x+this.skeleton.head.width/2,this.skeleton.head.y),new Measurement("shoulders",this.currentScale,[{x:this.skeleton.shoulderLeft.x,y:this.skeleton.shoulderLeft.y-.3*this.skeleton.head.height},{x:this.skeleton.shoulderRight.x,y:this.skeleton.shoulderRight.y-.3*this.skeleton.head.height}]).bindBone(b,this.skeleton.chestCenter).compute(this.skeleton,a)},b.prototype.doMeasurements=function(a,b,c,d){return this.humanBody=new HumanBody(a,b,c,d,this.side),this.skeleton=this.humanBody.skeleton,this.trunk=this.trunk(b),this.waist=this.humanWaist(b),this.hips=this.humanHips(b),this.bust=this.humanBust(b),this.shoulders=this.humanShoulders(b),this.side||(this.wrist=this.humanRightWrist(b)),this.drawMeasurements()},b.prototype.updateReferenceWithHand=function(a){var b,c,d,e,f,g;if(null!=this.skeleton&&(c=this.skeleton.armRight,f=this.skeleton.handRight,b=Math.atan2(f.y-c.y,f.x-c.x),g=this.skeleton.head.width/4,d=Math.sin(b)*g,e=Math.cos(b)*g,this.currentScale.change(a,"cm"),!isNaN(f.x-d)&&0!==parseInt(g)))return this.reference.points=[new Point(Math.min(f.x-d,.97*this.humanBody.map.cols),Math.min(f.y-e,.99*this.humanBody.map.rows)),new Point(Math.min(f.x+d,.99*this.humanBody.map.cols),Math.min(f.y+e,.99*this.humanBody.map.rows))],this.reference.realMeasurement=a,this.currentScale.change(this.reference.realMeasurement/this.reference.value(1),"cm")},b.prototype.points=function(){var a,b,c,d,e,f,g,h,i,j,k,l;if(c=[],CanvasPreview.conf.drawMeasurements)for(k=this.measures(),e=0,h=k.length;h>e;e++)if(a=k[e],null!=a)for(d=a.points,f=0,i=d.length;i>f;f++)b=d[f],c.push(b);if(CanvasPreview.conf.drawSkeleton)for(l=this.skeleton.points,g=0,j=l.length;j>g;g++)b=l[g],c.push(b);return c},b.prototype.measures=function(){var a,b,c,d;return d=search.measuresNeeded(),c=this.side?d.side:d.front,b=function(){var b,d,e;for(e=[],b=0,d=c.length;d>b;b++)a=c[b],e.push(this[a]);return e}.call(this),b.push(this.reference),b},b.prototype.drawMeasurements=function(a){var b,c,d,e,f,g;for(d=this,g=this.measures(),b=e=0,f=g.length;f>e;b=++e)c=g[b],null!=c&&(c.name===this.selectedMeasurement?canvasPreview.setStyleActive():c===this.reference?canvasPreview.setStyleReference():canvasPreview.setDefaultStyle(),canvasPreview.plotMeasurement(c,a));return this.drawSkeleton()},b.prototype.drawHelpMeasurements=function(){var a,b;return b=this,a=new Image,a.onload=function(){var c,d,e,f,g,h,i;for(c=b.helpCanvasPreview.ctx,c.clearRect(0,0,c.canvas.width,c.canvas.height),c.drawImage(a,0,0),h=b.helpMeasurements,i=[],d=f=0,g=h.length;g>f;d=++f)e=h[d],null!=e?(e.name===b.selectedMeasurement?b.helpCanvasPreview.setStyleActive():b.helpCanvasPreview.setDefaultStyle(),i.push(b.helpCanvasPreview.plotMeasurement(e))):i.push(void 0);return i},a.src=this.helpImage},b.prototype.drawSkeleton=function(){return canvasPreview.plotSkeleton(this.skeleton)},b.prototype.helpPointsFor={m:{front:{shoulders:[{x:39,y:62},{x:103,y:62}],bust:[{x:52,y:86},{x:93,y:86}],waist:[{x:10,y:70},{x:50,y:70}],hips:[{x:10,y:90},{x:50,y:90}],right_wrist:[{x:60,y:90},{x:65,y:85}],trunk:[{x:40,y:45},{x:40,y:90}]},side:{bust:[{x:44,y:70},{x:92,y:70}],waist:[{x:60,y:80},{x:110,y:80}],hips:[{x:48,y:124},{x:88,y:124}]}},f:{front:{shoulders:[{x:39,y:56},{x:103,y:56}],bust:[{x:48,y:86},{x:93,y:86}],waist:[{x:50,y:113},{x:92,y:113}],hips:[{x:39,y:140},{x:100,y:140}],right_wrist:[{x:60,y:90},{x:65,y:85}],trunk:[{x:48,y:56},{x:48,y:113}]},side:{bust:[{x:50,y:78},{x:93,y:78}],waist:[{x:58,y:110},{x:90,y:110}],hips:[{x:48,y:134},{x:88,y:134}]}}},b.prototype.help=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;for(i=search.measuresNeeded(),d=search.gender.toLowerCase(),f=this.helpPointsFor[d],this.side?(j=f.side,this.helpMeasurements=function(){var a,b,c,d;for(c=i.side,d=[],a=0,b=c.length;b>a;a++)h=c[a],d.push(new Measurement(h,null,j[h]));return d}()):(j=f.front,this.helpMeasurements=function(){var a,b,c,d;for(c=i.front,d=[],a=0,b=c.length;b>a;a++)h=c[a],d.push(new Measurement(h,null,j[h]));return d}()),this.helpImage="/images/manikin_"+d+"_"+(this.side?"side":"front")+".png",o=this.measures(),k=0,m=o.length;m>k;k++)for(g=o[k],p=this.helpMeasurements,l=0,n=p.length;n>l;l++)e=p[l],g&&g.name&&e&&e.name&&(g.help=e,e.help=g,g.canvas=a,e.canvas=b);return c=b.getContext("2d"),this.helpCanvasPreview=new CanvasPreview(c)},b}()}.call(this),function(){this.DetectCameraStep=function(){function a(a,b,c,d,e){this.wizard=a,this.segmentation=b,this.navigator=c,this.video=d,this.modal=e,this.hasCamera=null!=this.navigator.getUserMedia,this.userAllowToUserCamera=!1,this.help={title:"Detecção da câmera",content:"<p>\n  Vamos lhe ajudar a tirar suas medidas e precisamos da sua câmera.\n</p>\n<p>\n  O aspect irá lhe enviar um pedido de uso da câmera. Se você já bloqueiou alguma vez a câmera do aspect, por favor confira as permissões do seu browser.\n</p>\n<h4>Problemas</h4>\n<p>\n  Se você está vendo a tela da câmera preta ou branca, quem saiba você está com a câmera bloqueada por outro software. Observe se não tem outro aplicativo utilizando a câmera.\n</p>"}}return a.prototype.perform=function(){var a,b,c,d;return d=this,a=function(a){var b;return $("#modal-camera-detect").find(".modal-content h2").text("Falha no acesso da câmera"),$("#modal-camera-detect").find(".modal-content p").text("Infelizmente não conseguimos reconhecer a câmera do seu computador, poderia verificar e tentamos novamente?"),$("#camera-icon").attr("src","/images/no-cam.png"),b=$("<input type='button' class='btn btn-aspect' value='Tentar novamente' />"),b.on("click",function(){return window.location.reload()}),$("#modal-camera-detect").find(".modal-content p").append(b)},c=function(b){var c,e;return d.userAllowToUserCamera=!0,e=window.URL||window.webkitURL,d.video.src=e.createObjectURL(b),$("#modal-camera-detect").find(".modal-content h2").text("Obrigado!"),$("#modal-camera-detect").find(".modal-content p").text("Iniciando o processo..."),$("#camera-icon").attr("src","/images/love-cam.png"),c=function(b){return 0===this.segmentation.getCameraImage().data[3]?b>10?a():setTimeout(c,500,b+1):(this.segmentation.clearCanvas(),d.wizard.next())},setTimeout(c,500,0)},b=function(a){var b;return $("#modal-camera-detect").find(".modal-content h2").text("Você bloqueou o acesso a câmera"),$("#modal-camera-detect").find(".modal-content p").text("Desta maneira não podemos tirar suas medidas. Desbloqueie a câmera para continuar."),$("#camera-icon").attr("src","/images/no-cam.png"),b=$("<input type='button' class='btn btn-aspect' value='Tentar Novamente' />"),b.on("click",function(){return wizard.redo()}),$("#modal-camera-detect").find(".modal-content p").append(b)},this.hasCamera?this.navigator.getUserMedia({video:!0,audio:!1},c,b):$("#camera-icon").attr("src","/images/no-cam.png")},a}()}.call(this),function(){this.CreditCardMeasureStep=function(){function a(a,b){this.wizard=a,this.modal=b,this.creditCardResizer=new Resizer("#credit_card",this.onResizeCreditCard.bind(this)),this.realImageWidth=320,this.creditCardResizer.realSize=8.5,this.creditCardRatio=parseFloat(App.readCookie("creditCardRatio")),null!=this.creditCardRatio&&isNaN(this.creditCardRatio)&&delete this.creditCardRatio,this.help={title:"Medida do cartão de créditos",content:'<p>\n  Para obter medidas\n  precisas, necessitamos\n  saber o tamanho da sua\n  tela, para isso usamos as\n  dimensões de um cartão\n  de crédito comum e\n  cruzamos com a\n  resolução usada por seu\n  computador.\n</p>\n<p>\n  Não se preocupe,\n  nenhum dado do cartão\n  será inserido.\n</p>\n<p>\n  Posicione o cartão sobre\n  a figura.\n</p>\n<h3>Problemas</h3>\n<h4>Meu cartão não coicide em largura e altura ao mesmo tempo?</h3>\n<p>Possívelmente, a resolução do seu computador está incompatível com o formato da tela, achatando ou esticando a visão. Para continuar, confira e ajuste a resolução do seu monitor para uma resolução adequada.</p>\n<hr />\n<h4>Não tenho um cartão para medir e agora?</h4>\n<p>Você pode usar outro objeto de referência segurando o objeto nas fotos. Clique <a href="#" id="do-not-use-hand-measure" >aqui</a> se quiser seguir sem o cartão. </p>'}}return a.prototype.onResizeCreditCard=function(){return this.creditCardRatio=this.creditCardResizer.realSize/this.creditCardResizer.scale/this.creditCardResizer.width,App.setCookie("creditCardRatio",this.creditCardRatio)},a.prototype.perform=function(){return null==this.creditCardRatio&&this.onResizeCreditCard(),this.wizard.nextStep()},a.prototype.onOpenModal=function(){return null!=this.creditCardRatio?this.wizard.next():void this.animateOnStart()},a.prototype.animateOnStart=function(){var a,b,c;return b=parseFloat(this.creditCardResizer.scale||1),a=this.realImageWidth,$("#credit_card").css({width:a+"px"}),this.creditCardResizer.setScale(b),c=this,$("#credit_card").animate({width:"50vh"},"fast",function(){return $("#credit_card").animate({width:"25vh"},"slow",function(){return $("#credit_card").animate({width:"75vh"},"normal",function(){return $("#credit_card").animate({width:a+"px"},"slow",function(){return c.creditCardResizer.setScale(b)})})})})},a}(),this.HandMeasureStep=function(){function a(a,b,c){var d;this.wizard=a,this.creditCard=b,this.modal=c,this.realImageWidth=1809,this.handWithoutThumb=655,this.handResizer=new Resizer("#hand_reference",this.onResizeHand.bind(this)),d=App.readCookie("scaleHand")||1,this.handResizer.setScale(parseFloat(d)),this.help={title:"Medida da mão",content:'<p>\n  No aspect, usamos a mão como referência para facilitar o uso do aplicativo sem nenhuma ferramenta extra.\n</p>\n<p>\n  A parte que o aspect usa é a palma da mão, conforme a tarja amarela lateral a imagem de exemplo.\n</p>\n<h4>Por que precisamos disso?</h4>\n<p>\n  Usamos a proporção da largura da mão para escalar as outras medidas.  Dessa maneira,a mão é uma medida de referência, e serve como base para correlacionar e encontrar o tamanho das outras medidas do corpo.\n</p>\n<h3>Problemas</h3>\n<h4>Minha tela é menor que minha mão?</h3>\n<p>O importante é fazer a medida da largura da mão desconsiderando o polegar. Se mesmo assim sua mão mão não couber na tela, você pode utilisar outro objeto de referência segurando o objeto nas fotos. Clique <a href="#" id="do-not-use-hand-measure" >aqui</a> se quiser seguir sem a medida da mão.</p>\n<hr />\n<h4>Não tenho a mão esquerda?</h3>\n<p>O importante é fazer a medida da largura da palma da mão desconsiderando o polegar. Posicione a mão inversa e apenas redimensione para que a tarja amarela fique do mesmo tamanho.\n<hr />\n<h4>Minha mão não encaixa no exemplo</h3>\n<p>Se seus dedos são maiores ou menores, isso não importa. O importante é fazer a medida da largura da palma da mão desconsiderando o polegar.'}}return a.prototype.perform=function(){return this.onResizeHand(),this.wizard.nextStep()},a.prototype.onResizeHand=function(){return this.pixelsHand=this.handResizer.width,this.scaleHand=this.handResizer.scale,App.setCookie("scaleHand",this.scaleHand),this.computeHandSize()},a.prototype.computeHandSize=function(){var a,b,c,d,e,f;for(b=this.creditCard.creditCardRatio*this.pixelsHand*this.scaleHand*this.handWithoutThumb/this.realImageWidth,b=Math.round(100*b)/100,this.handResizer.realSize=b,f=this.wizard.actions,d=0,e=f.length;e>d;d++)a=f[d],a instanceof BodyMeasurementStep&&(c=b,a.handSize=c);return $("#hand-size").text(""+this.handResizer.realSize+"cm")},a.prototype.onOpenModal=function(){var a;return a=this,$("#back_to_creditcard_step").on("click",function(){return App.expireCookie("creditCardRatio"),delete a.creditCard.creditCardRatio,a.wizard.setStep(a.step-1)}),$("#toggle-hand").on("click",function(){return a.handResizer.toggleRotation()}),this.animateOnStart()},a.prototype.animateOnStart=function(){var a,b,c;return b=parseFloat(App.readCookie("scaleHand")||1),a=this.realImageWidth/2,$("#hand_reference").css({width:a+"px"}),c=this,this.handResizer.setScale(b),$("#hand_reference").animate({width:"50vh"},"fast",function(){return $("#hand_reference").animate({width:"25vh"},"slow",function(){return $("#hand_reference").animate({width:"75vh"},"normal",function(){return $("#hand_reference").animate({width:a+"px"},"slow",function(){return c.handResizer.setScale(b)})})})})},a}(),this.Resizer=function(){function a(a,b,c){this.onResize=b,this.bindInstance=c,this.element=$(a),this.startX=-1,this.startY=-1,this.scale=1,this.startScale=1,this.rotated=!1,this.setupElementEvents(),this.width=this.element.width(),this.height=this.element.height()}return a.prototype.resize=function(a,b){var c,d,e,f;return f=this.width*this.startScale,d=this.height*this.startScale,e=Math.sqrt(f*f+d*d),c=this.scale,c+=a/e,c=Math.max(.25,c),c=Math.min(2.5,c),this.setScale(c),this.stopPropagation(b)},a.prototype.setScale=function(a){
return this.scale=a,this.redraw(),this.width=this.element.width(),this.height=this.element.height(),this.onResize()},a.prototype.redraw=function(){return this.element.css({transform:"scale("+this.scale+")","transform-origin":"0 0","margin-bottom":""+Math.max(0,this.height*this.scale-this.height)+"px"})},a.prototype.toggleRotation=function(){return this.rotated=!this.rotated,this.rotated?this.element[0].src="./images/hand_left.png":this.element[0].src="./images/hand.png",this.redraw()},a.prototype.stopPropagation=function(a){return a.stopPropagation(),a.preventDefault()},a.prototype.stopDrag=function(a){return this.startX=-1,this.startY=-1,this.stopPropagation(a)},a.prototype.setupElementEvents=function(){var a;return this.element.off(),a=this,this.element.on("mousedown",function(b){return a.startX=b.offsetX,a.startY=b.offsetY,a.stopPropagation(b)}),this.element.on("mousemove",function(b){return-1!==a.startX?(a.resize(a.distanceFrom(b),b),a.stopPropagation(b)):void 0}),this.element.on("mouseup",this.stopDrag.bind(this)),this.element.on("mouseout",this.stopDrag.bind(this)),this.element[0].addEventListener("DOMMouseScroll",this.wheel.bind(this),!1),this.element[0].onmousewheel=this.wheel.bind(this)},a.prototype.distanceFrom=function(a){return this.distanceX=(a.offsetX-this.startX)*this.startScale,this.distanceY=(a.offsetY-this.startY)*this.startScale,this.distanceX+this.distanceY},a.prototype.wheel=function(a){var b;return b=0,a||(a=window.event),a.wheelDelta?b=a.wheelDelta/120:a.detail&&(b=-a.detail/3),b&&this.resize(3*b,a),a.preventDefault&&a.preventDefault(),a.returnValue=!1},a}()}.call(this),function(){this.BackgroundTrackerStep=function(){function a(a,b,c){this.wizard=a,this.segmentation=b,this.modal=c,this.bgCaptures=this.segmentation.bgCaptures,this.reset(),this.help={title:"Reconhecimento do ambiente",content:"<p>\n  Para evitar problemas com a luz e ruído do ambiente, o aspect reconhece o fundo do ambiente antes de fazer as medidas.\n</p>\n<p>\n  Capturando as imagens de fundo, o aspect elimina ruídos previamente conhecidos, permitindo reconhecer o corpo da pessoa com maior precisão.\n</p>\n<h4>Problemas</h4>\n<p>\n  Alguns casos comuns em que o aspect não irá reconhecer o ambiente:\n\n  <ul>\n  <li>Existe algum objeto em movimento permanente sobre a câmera?</li>\n  <li>Alguma janela aberta que possa ter uma luminosidade variável?</li>\n  <li>O computador ou a câmera usada está em movimento ou sofre vibrações</li>\n  </ul>\n</p>"}}return a.prototype.reset=function(){return this.startedAt=new Date,this.bgMin=null,this.bgMax=null,this.trackEnough=!1,this.index=0},a.prototype.perform=function(){return this.reset(),this.trackBG(),this.clearCanvas(),canvasPreview.mirrorCamera=!0,App.resizeScreen()},a.prototype.clearCanvas=function(){return canvasPreview.clear(),this.segmentation.clearCanvas()},a.prototype.onSuccess=function(a){return this.clearCanvas(),this.wizard.next(),UI.audio("success","mp3").play()},a.prototype.onFail=function(a){return UI.showDialog("Detectamos movimentação na câmera. Por favor posicione-se fora do campo de visão da câmera.","cam-ok",4e3),setTimeout(this.perform.bind(this),4e3)},a.prototype.stop=function(){return null!=this.timeoutId?clearTimeout(this.timeoutId):void 0},a.prototype.trackBG=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(null==a){if(f=this,null!=this.countdown)return;return UI.showDialog("Permaneça <strong>fora</strong> do campo de visão da câmera.","cam-ok",2e3),this.countdown=new CountdownTimer(6,function(){return UI.infoUser("Contagem regressiva"),f.timeoutId=setTimeout("backgroundTracker.trackBG(0)",10),delete f.countdown}),delete f.countdown.flash,void this.countdown.perform()}if(UI.progress(100*(a+1)/this.bgCaptures),a<this.bgCaptures){if(c=this.segmentation.getCameraImage(a),b=ImageProcessing.grayBlurData(c,1),0===a)for(this.bgMin=this.segmentation.getImage(),this.bgMax=this.segmentation.getImage(),this.bgGrayMax=ImageProcessing.matrix(b.cols,b.rows),this.bgGrayMin=ImageProcessing.matrix(b.cols,b.rows),n=this.bgGrayMin.data,e=h=0,k=n.length;k>h;e=++h)g=n[e],this.bgGrayMin.data[e]=255;for(o=c.data,e=i=0,l=o.length;l>i;e=++i)g=o[e],e%4===3?(this.bgMin.data[e]=255,this.bgMax.data[e]=255):(this.bgMin.data[e]=Math.min(this.bgMin.data[e],g),this.bgMax.data[e]=Math.max(this.bgMax.data[e],g));for(p=b.data,e=j=0,m=p.length;m>j;e=++j)g=p[e],this.bgGrayMin.data[e]=Math.min(this.bgGrayMin.data[e],g),this.bgGrayMax.data[e]=Math.max(this.bgGrayMax.data[e],g);return this.timeoutId=setTimeout("backgroundTracker.trackBG("+(a+1)+")",100)}return d=ImageProcessing.imageDifferenceInPercent(this.bgMin,this.bgMax),d>10?this.onFail(d):($(".frames").empty(),this.segmentation.publishFrameStep("bgGray min "+a,this.bgGrayMin.data),this.segmentation.publishFrameStep("bgGray MAX "+a,this.bgGrayMax.data),this.segmentation.feedBackgroundImages([this.bgGrayMin,this.bgGrayMax],[this.bgMin,this.bgMax]),this.onSuccess(d))},a}()}.call(this),function(){this.BodyMeasurementStep=function(){function a(a,b,c,d,e){var f;this.wizard=a,this.canvasLarge=b,this.segmentation=c,this.modal=d,this.side="side"===e,this.canvas=this.segmentation.canvas,this.canvasScale=this.canvasLarge.width/this.canvas.width,canvasPreview.scale=this.canvasScale,this.content=this.segmentation.ctx,this.bodyCaptures=1,f=this.side?["perfil","side"]:["frente","front"],this.poseLabel=f[0],this.pose=f[1],this.help={title:"Medidas do corpo de "+this.poseLabel,content:"<p>\nEste é um dos principais passos do aspect.\nA extração de medidas precisa de sua ajuda para conferir alguns detalhes das suas medidas.\n</p>\n<h4>Posicionamento da medida de referência</h4>\n<p>\nA medida de referência padrão é a palma da mão.\nSe você usar outro objeto como medida, funciona exatamente da mesma maneira que a mão,\napenas você terá que digitar o valor em centímetros das medidas utilizadas.\n</p>\n<p>\nA utilização da mão é apenas para evitar que você precise de algum objeto externo.\n</p>\n<hr />\n<h4>O software não está reconhecendo meu rosto</h4>\n<p>\nUsamos um padrão de reconhecimento de faces baseado em imagens reais. No entanto dependendo das condições de luz o reconhecimento pode falhar.\n</p>\n<ul>\n <li>Verifique se você não está em baixo de uma luz muito forte</li>\n <li>Verifique se seu rosto não está coberto por sombra ou se está parcialmente fora do campo de visão da câmera.</li>\n</ul>\n<hr />\n<h4>As medidas não batem</h4>\n<ul>\n <li>Verifique o tamanho do cartão</li>\n <li>Re-verifique o tamanho de sua mão ou objeto de referência</li>\n <li>Confirme que você ajustou a medida de referênca sobre a mão ou objeto que você escolheu</li>\n <li>Verifique o plano de seu objeto de referência é o mesmo plano das suas medidas</li>\n <li>Verifique se sua mão ou objeto de referência não estava rotacionado, pois a palma da mão precisa estar de frente para câmera pois a medida de referência é a largura da mão.</li>\n</ul>"}}return a.prototype.findHands=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;for(c=this.segmentation.findHandFist(this.canvas),h=this.segmentation.findHandOpen(this.canvas),d=[{type:"open",rgb:[255,255,255],finds:h},{type:"fist",rgb:[0,0,255],finds:c}],g=null,i=null,j=0,l=d.length;l>j;j++)for(f=d[j],n=f.finds,k=0,m=n.length;m>k;k++)if(e=n[k],b=e[4],b>13&&e[2]<a.height){if(e[0]<a.x){if(g)continue;g={x:e[0],y:e[1],width:e[2],height:e[3],confidence:e[4],type:f.type,side:"left",rgb:f.rgb,data:e}}if(e[0]>a.x){if(i)continue;i={x:e[0],y:e[1],width:e[2],height:e[3],confidence:e[4],type:f.type,side:"right",rgb:f.rgb,data:e}}}return[g,i]},a.prototype.observeSegmentation=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;if(!this.stopped)return canvasPreview.clear(),this.segmentation.refreshVideo(),this.segmentation.refreshVideo(canvasPreview.ctx),canvasPreview.drawManikin(search,this.side),j=(new Date).getTime(),i=this,this.face=this.segmentation.findFace(),null!=this.face&&(l=this.face.x,m=this.face.y,k=this.face.width,f=this.face.height,e=[l,m,k,f],this.previousFace=e,this.face.height>this.canvas.height/4?this.face.height>this.canvas.height/3?(this.willTakePicture=!0,clearTimeout(this.waitAllowTakePicture),UI.showDialog("Você está muito próximo a câmera, poderia se afastar um pouco para tentarmos novamente?","shy"),canvasPreview.drawRect(e,"rgba(230,0,0,0.5)")):(this.willTakePicture=!0,clearTimeout(this.waitAllowTakePicture),UI.showDialog("Afaste-se um pouco mais.","shy"),canvasPreview.drawRect(e,"rgba(180,180,0,0.5)")):this.face.y+4*this.face.height>this.canvas.height?(this.willTakePicture=!0,clearTimeout(this.waitAllowTakePicture),UI.showDialog("Posicione a camera. Cabeça e quadril devem estar visíveis.","shy"),canvasPreview.drawRect(e,"rgba(0,0,0,0.5)")):i.willTakePicture?(UI.showDialog("Identificamos sua face agora mantenha-se parado de "+this.pose+".<br/>Aguarde...","info"),a=function(){return delete i.willTakePicture},0===this.images.length?(c=2e3,UI.progress(50/this.bodyCaptures),UI.showDialog("Identificamos sua face agora mantenha-se parado de "+this.pose+".<br/><b>Posicione-se conforme exemplo</b>.","info",2e3)):c=200,this.waitAllowTakePicture=setTimeout(a,c)):(UI.infoUser("Capturando imagem "+this.pose+" "+(this.images.length+1)+" de "+this.bodyCaptures+"!"),this.images.length<=this.bodyCaptures&&(g=this.segmentation.getImage(),b=canvasPreview.ctx,h=this.segmentation.getImage(b),d=this.face,null!=d&&null!=g&&this.images.push({image:g,imageLarge:h,face:d}),UI.progress(100*this.images.length/this.bodyCaptures),this.willTakePicture=!0),this.images.length===this.bodyCaptures&&(delete this.countdown,this.registerCanvas(),this.stopSegmentation(),this.segmentation.clearCanvas(),canvasPreview.clear(),setTimeout(this.wizard.next.bind(this.wizard),1e3),UI.audio("success","mp3").play()))),UI.performanceReport((new Date).getTime()-j),null!=this.timeoutID?this.timeoutID=setTimeout(i.observeSegmentation.bind(i),40):void 0},a.prototype.selectCurrentImage=function(a){var b;return this.currentImage=a,b=this.results[this.currentImage],this.measurements=b.measurements,this.imageLarge=b.imageLarge,this.drawMeasurements(),this.startHelpMeasurement()},a.prototype.thumbnail=function(){return canvasPreview.thumbnailTo($("#thumbnail-"+this.pose)[0])},a.prototype.proccessImage=function(a,b,c){var d,e,f,g,h,i,j,k;return k=this.segmentation.proccess(a),e=k[0],h=k[1],f=k[2],this.results||(this.results=[]),h?(this.segmentation.clearWith(a),d=this.findHands(c),g=d[0],j=d[1],i=new Measurements(this.context,this.canvas.width,this.canvas.height,this.side),i.doMeasurements(c,h,g,j),null!=this.handSize&&i.updateReferenceWithHand(this.handSize),canvasPreview.drawRect(c.data,"rgba(0,230,0,0.5)"),this.results.push({image:a,imageLarge:b,imageData:e,map:h,imageGray:f,face:c,measurements:i}),this.selectCurrentImage(this.results.length-1),this.thumbnail()):void 0},a.prototype.selectBetterResult=function(){var a,b,c,d,e;for(d=this.results,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a);return e},a.prototype.registerCanvas=function(){var a,b;return b=this.segmentation.getImage(),a=$("<canvas></canvas>").get(0),a["class"]="pose-"+this.pose,a.info={step:this},a.width=b.width,a.height=b.height,a.getContext("2d").putImageData(b,0,0),$("#gallery").append(a)},a.prototype.startSegmentation=function(){var a;return this.startedAt=new Date,null!=this.timeoutID&&this.stopSegmentation(),delete this.stopped,a=this,this.willTakePicture=!0,this.timeoutID=setTimeout(a.observeSegmentation.bind(a),3e3),UI.infoUser("Contagem Regressiva","info",3e3),this.verifyCapturing=function(b){return null!=a.timeoutID?(a.face||UI.showDialog("Infelizmente não estamos conseguimos reconhecer sua face.",(new Date).getMilliseconds()%2===1?"sad":"sad2"),setTimeout(a.verifyCapturing,5e3,a.images.length)):void 0},setTimeout(this.verifyCapturing,a.images.length,5e3)},a.prototype.stopSegmentation=function(){return this.stopped=!0,clearTimeout(this.timeoutID),delete this.timeoutID},a.prototype.startHelpMeasurement=function(){var a,b;return a=$("#help_measurements"),b=this,this.measurements.help(this.canvasLarge,a[0]),a[0].getContext("2d").clearRect(0,0,a.width(),a.height()),a.on("mousemove",function(c){var d,e,f,g,h,i,j,k;if(b.stopped){for(b.measurements.selectedMeasurement="",j=b.measurements.helpMeasurements,f=0,h=j.length;h>f;f++)for(d=j[f],k=d.points,g=0,i=k.length;i>g;g++)e=k[g],e.isOver(b.mouseX(c),b.mouseY(c))&&(b.measurements.selectedMeasurement=d.name);return""!==b.measurements.selectedMeasurement?($(a).addClass("selecting"),b.measurements.showMeasureHelp()):(b.measurements.hideMeasureHelp(),$(a).removeClass("selecting")),b.drawMeasurements()}})},a.prototype.allowDragPoints=function(){var a;return a=$(this.canvasLarge),a.off(),a.on("mousedown",this.startDragging.bind(this)),a.on("mousemove",this.drag.bind(this)),a.on("mouseup",this.stopDragging.bind(this)),a.on("mouseout",this.stopDragging.bind(this))},a.prototype.mouseX=function(a){return a.offsetX},a.prototype.mouseY=function(a){return a.offsetY},a.prototype.startDragging=function(a){var b,c,d,e,f;for(c=this,f=this.measurements.points(),d=0,e=f.length;e>d;d++)if(b=f[d],b.isOver(this.mouseX(a),this.mouseY(a),this.canvasScale))return canvasPreview.zoom(b),this.selectedPoint=b},a.prototype.drag=function(a){var b,c,d,e,f,g,h,i,j,k;if(this.stopped){for(this.activePoint=null,this.measurements.selectedMeasurement="",d=(new Date).getTime(),j=this.measurements.measures(),f=0,h=j.length;h>f;f++)if(b=j[f],null!=b)for(k=b.points,g=0,i=k.length;i>g;g++)if(c=k[g],c.isOver(this.mouseX(a),this.mouseY(a),this.canvasScale)){this.activePoint=c,this.measurements.selectedMeasurement=b.name;break}return null!=this.selectedPoint?(this.selectedPoint.updateXY(this.mouseX(a),this.mouseY(a),this.canvasScale),this.selectedPoint.updateMeasurement(),e=(new Date).getTime(),this.drawMeasurements(this.selectedPoint),e=(new Date).getTime(),canvasPreview.zoom(this.selectedPoint),this.onAdjustMeasureTimeout&&(clearTimeout(this.onAdjustMeasureTimeout),this.onAdjustMeasureTimeout=void 0),this.onAdjustMeasureTimeout=setTimeout(this.onAdjustMeasure.bind(this),100)):(this.drawMeasurements(),null!=this.activePoint&&(canvasPreview.setStyleActive(),canvasPreview.drawPoint(this.activePoint))),null!=this.activePoint?($(this.canvas).addClass("moving"),this.measurements.showMeasureHelp()):($(this.canvas).removeClass("moving"),this.measurements.hideMeasureHelp())}},a.prototype.stopDragging=function(a){var b,c,d,e,f,g,h;if(this.stopped)return b=null!=(g=this.measurements)?g.reference:void 0,c=this,null!=b&&(null==b.realMeasurement?b.points.indexOf(this.selectedPoint)>=0?((f=this.measurements.reference).dragTimes||(f.dragTimes=0),this.measurements.reference.dragTimes++,this.measurements.reference.dragTimes>=2&&(delete this.selectedPoint,d=function(){var a,d,e,f;return f=$("#new-scale").val().match(/(\d+)\s*(.*)/),e=f[0],d=f[1],a=f[2],null!=d&&null!=a?(b=c.measurements.reference,d=parseFloat(d)/b.value(1),c.measurements.currentScale.change(d,a),$("#modal-change-scale").modal("hide"),$(".perform-step, .next-step").removeClass("hidden"),c.drawMeasurements()):void 0},$("#modal-change-scale").modal({backdrop:"static",keyboard:!1}),$("#modal-change-scale input#new-scale").focus(),$("#modal-change-scale input#new-scale").on("keyup",function(a){return 13===a.keyCode?d():void 0}),$("#modal-change-scale .btn-success").on("click",d))):null==(null!=(h=this.measurements.reference)?h.dragTimes:void 0)&&(e=(new Date).getTime()-this.startedAt.getTime()>1e4,e&&UI.infoUser("Lembre-se de ajustar a medida da mão!","warn")):this.measurements.currentScale.change(b.realMeasurement/b.value(1),"cm")),this.drawMeasurements(),delete this.selectedPoint},a.prototype.drawMeasurements=function(a){return canvasPreview.clearWith(this.imageLarge),this.measurements.drawMeasurements(a),this.measurements.drawHelpMeasurements()},a.prototype.perform=function(){return this.images=[],this.stopped=!1,this.startSegmentation(),$(".video-preview .perform-step, .video-preview .next-step").addClass("hidden"),canvasPreview.mirrorCamera=!0,App.resizeScreen()},a.prototype.stop=function(){return this.stopSegmentation()},a.prototype.onOpenModal=function(){var a;return"M"!==search.gender?(a=this.modal.find("img"),a.attr("src",a.attr("src").replace("male","female"))):void 0},a}()}.call(this),function(){this.AdjustMeasuresStep=function(){function a(a,b,c,d,e){var f;this.wizard=a,this.front=b,this.side=c,this.modal=d,this.modal2=e,this.steps={front:this.front,side:this.side},f=this,this.front.onAdjustMeasure=this.side.onAdjustMeasure=function(){return f.findBestWearFit(),f.showMeasuresInTable(this),this.thumbnail()},this.currentStep="front",this.help={title:"Ajuste das medidas do corpo",content:"<p>\nTODO\n</p>"}}return a.prototype.onOpenModal=function(){return this.proccessImages()},a.prototype.findBestWearFit=function(){var a,b,c,d,e,f,g,h,i,j;if(j=[this.front.measurements,this.side.measurements],c=j[0],g=j[1],f=new Search,b=f.fitsWith(c,g),null!=b&&0!==b.length){for($("#fits").empty(),d=h=0,i=b.length;i>h&&(e=b[d],!(d>2));d=++h)a=$("<div class='col-sm-6 col-md-4' style='background: "+e.color+"'><div><span class='big-text'>"+e.spec.size.br+"</span> <span class='fit-label'>"+e.description+"</span></span></div>"),$("#fits").append(a);return $("#fits").removeClass("hidden")}},a.prototype.showMeasuresInTable=function(a){var b,c,d,e,f,g;for(c=$("<table></table>"),c.addClass("table-striped"),d=$("<tr></tr>"),d.append($("<td>Medida</td>")),d.append($("<td>Valor ("+a.measurements.currentScale.unity+")</td>")),c.append(d),g=a.measurements.measures(),e=0,f=g.length;f>e;e++)b=g[e],null!=b&&(d=$("<tr></tr>"),d.append($("<td>"+b.label+"</td>")),d.append($("<td>"+b.value()+"</td>")),c.append(d));return $(".measures-"+(a.measurements.side?"side":"front")).html(c)},a.prototype.proccessStepImage=function(a){var b,c,d,e,f,g,h,i,j,k;return canvasPreview.mirrorCamera=!1,k=a.pop(),j=k.step,f=k.image,g=k.imageLarge,e=k.face,h=k.name,c=k.counter,b=$("#current-proccessing")[0],d=b.getContext("2d"),d.putImageData(f,0,0,0,0,b.width,b.height),j.proccessImage(f,g,e),i="("+h+") "+parseInt(100*(c-a.length)/c)+"%",$("#measuring-progress").html("Processando: "+i),UI.infoUser("Aguarde, processando medidas "+i),a.length>0?setTimeout(this.proccessStepImage.bind(this),100,a):setTimeout(this.finish.bind(this),500)},a.prototype.proccessImages=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;g=[],a=0,l=this.steps;for(e in l)for(f=l[e],m=f.images,h=0,j=m.length;j>h;h++)n=m[h],c=n.image,b=n.face,a++;o=this.steps;for(e in o)for(f=o[e],p=f.images,i=0,k=p.length;k>i;i++)q=p[i],c=q.image,d=q.imageLarge,b=q.face,g.push({step:f,image:c,imageLarge:d,face:b,name:e,counter:a});return this.proccessStepImage(g)},a.prototype.perform=function(){return UI.toggleSidemenu("open")},a.prototype.finish=function(){return UI.infoUser("Agora, se necessário arraste as medidas até a posição correta."),this.setCurrentStep(this.currentStep),this.modal.modal("hide"),this.modal2.modal("show"),$("#sidemenu").removeClass("hidden")},a.prototype.setCurrentStep=function(a){var b;return this.currentStep=a,canvasPreview.mirrorCamera=!1,App.resizeScreen(),b=this.steps[a],b.allowDragPoints(),b.drawMeasurements(),b.startHelpMeasurement()},a}()}.call(this),function(){this.VALID_EMAIL=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i,this.PublishInfo=function(){function a(a,b){this.user=a,this.measures=b}return a.url="https://aspect-server.herokuapp.com/measures",a.upload=function(b,c,d){return $.post(a.url,b,c,"json")},a.prototype.perform=function(b,c){var d;return d={measure:{from:this.user,set:this.measures}},a.upload(d,b,c)},a}(),this.ShowResultsStep=function(){function a(a,b,c,d){this.wizard=a,this.front=b,this.side=c,this.modal=d,this.button=this.modal.find(".upload-data"),this.email=this.modal.find("#email")}return a.prototype.onOpenModal=function(){var a;return a=this.uploadData.bind(this),this.email.on("keyup",function(b){return 13===b.keyCode?a():void 0}),this.button.on("click",a),this.setupUI()},a.prototype.perform=function(){return this.email.focus()},a.prototype.setupUI=function(){return this.drawImagesFromCanvas(),this.drawCirclesForMeasures()},a.prototype.drawImagesFromCanvas=function(){var a,b,c;return a=function(a,b){return b.drawMeasurements(),a.attr("src",b.canvasLarge.toDataURL()),a.attr("width",320)},b=this.modal.find(".picture.front"),c=this.modal.find(".picture.side"),a(b,this.front),a(c,this.side)},a.prototype.drawCirclesForMeasures=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;for(b=function(a,b){var c;return c='<div class="measure-circle">\n  <span class="value">'+b+'</span>\n  <span class="label">'+a+"</span>\n</div>"},c=this.modal.find(".measures-panel"),c.empty(),d={},i={},a={},o=this.front.measurements.measures(),k=0,m=o.length;m>k;k++)e=o[k],null!=e&&"reference"!==e.name&&(d[e.name]=e);for(p=this.side.measurements.measures(),l=0,n=p.length;n>l;l++)e=p[l],null!=e&&(i[e.name]=e,d[e.name]&&(j=Measure.round(e.name,this.front.measurements,this.side.measurements),a[e.name]=e,delete d[e.name],delete i[e.name]));q={"↔":d,"↷":i};for(h in q){f=q[h];for(g in f)e=f[g],c.append(b(""+h+": "+e.label,parseInt(100*e.value())/100))}r=[];for(g in a)e=a[g],r.push(c.append(b("☉"+e.label,parseInt(100*j)/100)));return r},a.prototype.uploadData=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(n=window.showResultsStep,b=n.email.val(),0===b.length)return void this.email.attr("placeholder","Digite seu email!");if(!VALID_EMAIL.test(b))return void this.email.attr("placeholder","Digite um email válido :(");for(this.button.prop("disabled",!0),this.button.val("Preparando medidas"),n.user={email:b},t=[n.front.measurements,n.side.measurements],e=t[0],o=t[1],u=function(){var a,b,c,d,f,j,k;for(f=[e,o],k=[],a=0,c=f.length;c>a;a++){for(i=f[a],delete i.canvasPreview,delete i.ctx,delete i.humanBody,delete i.skeleton,g={},j=i.measures(),b=0,d=j.length;d>b;b++)h=j[b],null!=h&&"reference"!==h.name&&(g[h.name]=h.value());k.push(g)}return k}(),e=u[0],o=u[1],n.publisher=new PublishInfo(n.user,{front:e,side:o}),d=n.modal.find(".modal-footer"),q=new Image,d.append(q),k=function(a){return console.log("publish info sucessfully",a),n.button.val("Ok! Medidas salvas!"),n.button.parent().append("<a href='"+PublishInfo.url+"/"+a.id+"'>Acesse suas medidas aqui.</a>")},j=function(a){return console.error("error sending data",a),n.button.val("Ops! Erro enviando medidas! (Tentar Novamente)"),n.button.prop("disabled",!1)},v=[n.front,n.side],w=[],r=0,s=v.length;s>r;r++)l=v[r],l.drawMeasurements(),a=l.canvasLarge,q.src=a.toDataURL("image/png"),f=a.toDataURL().split(",",2)[1],n.button.val("Uploading image... "),p=function(b){var c;return console.log("Store successful:",b),n.button.val("ok!"),a.remote_url=b.url,(c=n.publisher.user).images||(c.images=[]),n.publisher.user.images.push(b.url),2===n.publisher.user.images.length?(d.empty(),n.button.val("Publishing measures..."),n.publisher.perform(k,j)):void 0},c=function(a){return console.error("Store error:",a)},m=function(a){return n.button.val("Uploading "+a+"%")},w.push(ImageStore.upload(f,p,c,m));return w},a}()}.call(this),function(){this.Wizard=function(){function a(){this.step=0,this.actions=[]}return a.prototype.start=function(){return this.perform(1)},a.prototype.push=function(a){return this.actions.push(a),a.step=this.actions.length},a.prototype.nextStep=function(){var a;return null!=(a=this.currentAction)&&"function"==typeof a.stop&&a.stop(),this.step<this.actions.length&&(this.step+=1),this.setCurrentAction()},a.prototype.previousStep=function(){var a;return null!=(a=this.currentAction)&&"function"==typeof a.stop&&a.stop(),this.step>1&&(this.step-=1),this.setCurrentAction()},a.prototype.next=function(){return this.nextStep()},a.prototype.previous=function(){return this.previousStep()},a.prototype.setStep=function(a){return this.step=a,this.setCurrentAction()},a.prototype.setCurrentAction=function(){var a,b,c;return null!=this.currentAction&&this.currentAction.modal.modal("hide"),this.currentAction=this.actions[this.step-1],1===this.step&&this.perform(this.step),this.currentAction.modal.modal({keyboard:!1,backdrop:"static"}),"function"==typeof(b=this.currentAction).onOpenModal&&b.onOpenModal(),"function"==typeof this.onOpenModal&&this.onOpenModal(),a=this.currentAction.modal.find(".wizard-navigator"),a.html(this.stepsUI()),a=null!=(c=this.currentAction.modal2)?c.find(".wizard-navigator"):void 0,null!=a&&a.html(this.stepsUI()),this.currentAction},a.prototype.stepsUI=function(){var a,b,c,d,e,f,g,h,i;for(b=$("<div></div>"),e=this,c=function(){var a;return a=parseInt($(this).attr("value")),e.setStep(a)},i=this.actions.slice(1,-1),d=g=0,h=i.length;h>g;d=++g)f=i[d],a=$("<input type='button' class='circle goto-step' title='"+(f.help?f.help.title:"")+"' value='"+(9>d?"0":"")+(d+1)+"' />"),d===this.step-2?a.addClass("current"):d>this.step-2?a.attr("disabled","disabled"):a.on("click",c),b.append(a),d<this.actions.length-3&&b.append($("<span class='between-steps'>······</span>"));return b},a.prototype.perform=function(a){var b;return null!=a&&this.step!==a?this.setStep(a):null!=this.currentAction.startPerforming&&"function"==typeof(b=this.currentAction).stop&&b.stop(),this.currentAction.startPerforming=!0,this.currentAction.perform()},a.prototype.redo=function(){return this.perform(this.step)},a}()}.call(this),function(){this.Slide={hide:function(a,b,c){return $(a).animate({width:0,paddingLeft:0,paddingRight:0},b,c)},show:function(a,b,c){return $(a).animate({width:300,paddingLeft:10,paddingRight:10},b,c)}}}.call(this),function(){this.UI={showMeasureDescription:function(a){return a||(a=""),$("#measure-help").html(a)},infoUser:function(a,b,c){return null==c&&(c=4e3),$("#message").html(a),$("#message").attr("class","alert-"+b),$("#message").show(),null!=this.hideTimeout&&clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(function(){return $("#message").hide("slow")},c)},showDialog:function(a,b,c){var d;return null==b&&(b="info"),null==c&&(c=4e3),a!==this.lastDialogMessage?(this.lastDialogMessage=a,d=this,$("#message-dialog .message").html(a),$("#message-dialog").attr("class","modal dialog-"+b),$("#message-dialog").is(":visible")||$("#message-dialog").modal("show"),null!=this.hideDialogTimeout&&clearTimeout(this.hideDialogTimeout),this.hideDialogTimeout=setTimeout(function(){return $("#message-dialog").modal("hide"),d.lastDialogMessage=null},c)):void 0},flashScreen:function(){return $("body").animate({opacity:0},100),$("body").animate({opacity:1},300)},audio:function(a,b){var c;return c=document.createElement("audio"),c.id=a,c.src="/audio/"+a+"."+b,c},showHideCountdown:function(a,b){var c;return null==b&&(b=500),a?$("#countdown").show():(c=function(){return $("#countdown").hide()},setTimeout(c,b))},progress:function(a){return $("#countdown").html(""+parseInt(a)+"%"),this.showHideCountdown(100>a)},countdown:function(a){return $("#countdown").html(""+a),this.showHideCountdown(a>0)},performanceReport:function(a){var b;return $("#performance").html(""+a+"ms"),b=a>500?"red":a>200?"yellow":a>80?"blue":"green",$("#performance").attr("color",b)},toggleHelp:function(){var a;return null==UI.showingHelp?(null!=wizard.currentAction&&null!=(a=wizard.currentAction.help)&&($("#help-content").html(a.content),$("#help-title").html(a.title)),Slide.show(".help-content-wrapper",1e3),UI.showingHelp=!0):(delete UI.showingHelp,Slide.hide(".help-content-wrapper",1e3))},toggleSidemenu:function(a){return null==UI.showingSidemenu||"open"===a?(Slide.show(".sidemenu-content-wrapper",1e3),UI.showingSidemenu=!0):(delete UI.showingSidemenu,Slide.hide(".sidemenu-content-wrapper",1e3))}},this.App={readCookie:function(a){var b,c,d,e;for(e=a+"=",c=document.cookie.split(";"),d=0;d<c.length;){for(b=c[d];" "===b.charAt(0);)b=b.substring(1,b.length);if(0===b.indexOf(e))return b.substring(e.length,b.length).replace(/"/g,"");d++}},setCookie:function(a,b){var c;return c=new Date,c.setMonth(c.getMonth()+6),document.cookie=a+"="+escape(b)+";expires="+c.toGMTString()},expireCookie:function(a){return document.cookie=""+a+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"},resizeScreen:function(){var a,b;return b=window.innerHeight/canvas.height*.8,window.innerWidth<window.innerHeight&&(b=window.innerWidth/canvas.width),a="scaleY("+b+") scaleX("+b+")",$("#canvas-measures").css({"-webkit-transform":a,"-moz-transform":a,"-ms-transform":a,"-o-transform":a,transform:a}),canvasPreview.mirrorCamera&&(a="scaleY("+b+") scaleX("+-b+")"),$("#canvas, #video").css({"-webkit-transform":a,"-moz-transform":a,"-ms-transform":a,"-o-transform":a,transform:a})}},$(document).ready(function(){var a,b,c,d,e;return e=$("#video")[0],b=$("#canvas")[0],a=$("<canvas width='320' height='240'></canvas>")[0],$("#modal-welcome").modal({keyboard:!1,backdrop:"static"}),$("#help .help-title-wrapper").on("click",function(){return UI.toggleHelp()}),$("#sidemenu .sidemenu-title-wrapper").on("click",function(){return UI.toggleSidemenu()}),$("input[type=button].next-step").on("click",function(){var a;return null!=(a=$(this).parents(".modal"))&&a.modal("hide"),null!=UI.showingHelp&&UI.toggleHelp(),null!=UI.showingSidemenu&&UI.toggleSidemenu(),wizard.next()}),$("input[type=button].perform-step").on("click",function(){var a;return null!=(a=$(this).parents(".modal"))&&a.modal("hide"),null!=UI.showingHelp&&UI.toggleHelp(),null!=UI.showingSidemenu&&UI.toggleSidemenu(),wizard.perform()}),$("#thumbnail-front").on("click",function(){return adjustMeasuresStep.setCurrentStep("front")}),$("#thumbnail-side").on("click",function(){return adjustMeasuresStep.setCurrentStep("side")}),c=a.getContext("2d"),d=b.getContext("2d"),window.canvasPreview=new CanvasPreview(d),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.gui=new dat.GUI,window.segmentation=new Segmentation(a,e),window.wizard=new Wizard,window.search=new Search,window.cameraDetector=new DetectCameraStep(wizard,segmentation,navigator,e,$("#modal-camera-detect")),window.creditCardMeasureStep=new CreditCardMeasureStep(wizard,$("#modal-credit-card-measure")),window.handMeasureStep=new HandMeasureStep(wizard,creditCardMeasureStep,$("#modal-hand-measure")),window.backgroundTracker=new BackgroundTrackerStep(wizard,segmentation,$("#modal-background-tracker")),window.bodyMeasurementStep=new BodyMeasurementStep(wizard,b,segmentation,$("#modal-body-measurement-front")),window.bodySideMeasurementStep=new BodyMeasurementStep(wizard,b,segmentation,$("#modal-body-measurement-side"),"side"),window.adjustMeasuresStep=new AdjustMeasuresStep(wizard,bodyMeasurementStep,bodySideMeasurementStep,$("#modal-adjust-measures"),$("#modal-adjust-measures-2")),window.showResultsStep=new ShowResultsStep(wizard,bodyMeasurementStep,bodySideMeasurementStep,$("#modal-show-results")),wizard.push(cameraDetector),wizard.push(creditCardMeasureStep),wizard.push(handMeasureStep),wizard.push(bodyMeasurementStep),wizard.push(bodySideMeasurementStep),wizard.push(backgroundTracker),wizard.push(adjustMeasuresStep),wizard.push(showResultsStep),App.resizeScreen(),window.onresize=App.resizeScreen})}.call(this);